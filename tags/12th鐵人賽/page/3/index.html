<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>標籤: 12th鐵人賽 - 微笑家</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="微笑家"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="微笑家"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="程式教學 C#&amp;#x2F;JAVA&amp;#x2F;HTML5&amp;#x2F;NODE.JS，永恆的願望"><meta property="og:type" content="blog"><meta property="og:title" content="微笑の家"><meta property="og:url" content="https://nalocal.github.io/"><meta property="og:site_name" content="微笑の家"><meta property="og:description" content="程式教學 C#&amp;#x2F;JAVA&amp;#x2F;HTML5&amp;#x2F;NODE.JS，永恆的願望"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://avatars.githubusercontent.com/u/62000156"><meta property="article:author" content="NALocal"><meta property="article:tag" content="程式,教學,程式教學,C,C#,JAVA,HTML,HTML5,NODE,NODE.JS,JAVASCRIPT,CSS,SCSS,SASS,DISCORD,BOT,BLOG,心得,SMILE,NALOCAL,NA,IT,BACK,END,BackEnd,後端,hexo,fluid,pjax,微笑,微笑之家,微笑家"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://avatars.githubusercontent.com/u/62000156"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://nalocal.github.io/blog"},"headline":"微笑家","image":["https://nalocal.github.io/img/og_image.png"],"author":{"@type":"Person","name":"NALocal"},"description":"程式教學 C#&#x2F;JAVA&#x2F;HTML5&#x2F;NODE.JS，永恆的願望"}</script><link rel="icon" href="/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/atom.xml" title="微笑家" type="application/atom+xml">
</head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="微笑家" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/album">Album</a><a class="navbar-item" href="/friend">Friend</a><a class="navbar-item" href="/message">Message</a><a class="navbar-item" href="/self-talking">Self-talking</a><a class="navbar-item" href="/music">Music</a><a class="navbar-item" href="/media">Media</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">標籤</a></li><li class="is-active"><a href="#" aria-current="page">12th鐵人賽</a></li></ul></nav></div></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-11  <a class="commentCountImg" href="/2020/09/11/12thDay11/#comment-container"><span class="display-none-class">f46eab08f4240d9a71ab0704f5fa3ce0</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="f46eab08f4240d9a71ab0704f5fa3ce0">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>5 分鐘  <i class="fas fa-pencil-alt"> </i>0.8 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/11/12thDay11/">Day11 - 音樂系統(2)</a></h1><div class="content"><p><img src="https://i.imgur.com/0pmzip7.png" alt="11-1"></p>
<p>今天我們把剩下的功能做完</p>
<p>繼續做之前，我們回顧一下音樂播放的其中一小段</p>
<p><img src="https://i.imgur.com/LxEyK0Q.png" alt="11-2"></p>
<p>在playMusic2這段，我們將音樂網址與相關設定打入connection後，connection開始播放歌曲，並且返還控制項；<br>我們宣告一個dispatcher來接收控制項，並且在下一行監聽finish事件</p>
<p>從這一段會注意到他解決了一件事情，那就是我們該怎麼監測歌曲播放的狀態?</p>
<p>dispatcher這個物件在被賦予後，可以直接當成是我們的遙控器<br>不管是監聽歌曲是不是播完了，還是調整音量&amp;咖歌等，都會需要調用dispatcher</p>
<p>所以如果之後我們要繼續實作咖歌&amp;循環播放等功能，除了需要調用歌曲清單以外，還需要調用到dispatcher</p>
<p><img src="https://i.imgur.com/pcZSGNK.png" alt="11-3"></p>
<p>這邊在音樂系統的最上方，將dispatcher宣告成全域變數<br>並且記得原本宣告dispatcher的const要拿掉!</p>
<p>觀念說完，那我們繼續:</p>
<h2 id="中斷歌曲"><a href="#中斷歌曲" class="headerlink" title="中斷歌曲"></a>中斷歌曲</h2><pre><code>//?skip
function skipMusic() &amp;#123;
    //將歌曲關閉，觸發finish事件
    if (dispatcher !== undefined) dispatcher.end();
&amp;#125;
</code></pre>
<h2 id="重播歌曲"><a href="#重播歌曲" class="headerlink" title="重播歌曲"></a>重播歌曲</h2><pre><code>//?replay
function replayMusic() &amp;#123;
    if (musicList.length &gt; 0) &amp;#123;
        //把當前曲目再推一個到最前面
        musicList.unshift(musicList[0]);
        //將歌曲關閉，觸發finish事件
        //finish事件將清單第一首歌排出，然後繼續播放下一首
        if (dispatcher !== undefined) dispatcher.end();
    &amp;#125;
&amp;#125;
</code></pre>
<h2 id="顯示歌曲清單"><a href="#顯示歌曲清單" class="headerlink" title="顯示歌曲清單"></a>顯示歌曲清單</h2><pre><code>//?queue
async function queueShow(channelID) &amp;#123;
    try &amp;#123;
        if (musicList.length &gt; 0) &amp;#123;
            let info;
            let message = &#39;&#39;;
            for (i = 0; i &lt; musicList.length; i++) &amp;#123;
                //從連結中獲取歌曲資訊 標題 總長度等
                info = await ytdl.getInfo(musicList[i]);
                //歌曲標題
                title = info.videoDetails.title;
                //串字串
                message = message + `\n$&amp;#123;i+1&amp;#125;. $&amp;#123;title&amp;#125;`;
            &amp;#125;
            //把最前面的\n拿掉
            message = message.substring(1, message.length);
            client.channels.fetch(channelID).then(channel =&gt; channel.send(message))
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;queueShowError&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<h2 id="顯示當前歌曲"><a href="#顯示當前歌曲" class="headerlink" title="顯示當前歌曲"></a>顯示當前歌曲</h2><pre><code>//?np
async function nowPlayMusic(channelID) &amp;#123;
    try &amp;#123;
        if (dispatcher !== undefined &amp;&amp; musicList.length &gt; 0) &amp;#123;
            //從連結中獲取歌曲資訊 標題 總長度等
            const info = await ytdl.getInfo(musicList[0]);
            //歌曲標題
            const title = info.videoDetails.title;
            //歌曲全長(s)
            const songLength = info.videoDetails.lengthSeconds;
            //當前播放時間(ms)
            const nowSongLength = Math.floor(dispatcher.streamTime / 1000);
            //串字串
            const message = `$&amp;#123;title&amp;#125;\n$&amp;#123;streamString(songLength,nowSongLength)&amp;#125;`;
            client.channels.fetch(channelID).then(channel =&gt; channel.send(message))
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;nowPlayMusicError&#39;);
    &amp;#125;
&amp;#125;

//▬▬▬▬▬▬▬▬▬?▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
function streamString(songLength, nowSongLength) &amp;#123;
    let mainText = &#39;?&#39;;
    const secondText = &#39;▬&#39;;
    const whereMain = Math.floor((nowSongLength / songLength) * 100);
    let message = &#39;&#39;;
    for (i = 1; i &lt;= 30; i++) &amp;#123;
        if (i * 3.3 + 1 &gt;= whereMain) &amp;#123;
            message = message + mainText;
            mainText = secondText;
        &amp;#125; else &amp;#123;
            message = message + secondText;
        &amp;#125;
    &amp;#125;
    return message;
&amp;#125;
</code></pre>
<hr>
<p>這樣，我們的音樂系統的基本教學就告一段落</p>
<p><img src="https://i.imgur.com/MUI4mAt.png" alt="11-4"></p>
<p><img src="https://i.imgur.com/4i1uqpf.png" alt="11-5"></p>
<p><img src="https://i.imgur.com/HBYoQl6.png" alt="11-6"></p>
<p>其實音樂功能除了本篇教學的基本以外，還有很多花樣可以玩<br>這個寫法有個很大的問題是，有多個群組同時在使用時，機器人的歌單會掛掉</p>
<p>筆者明天想先說其他主題，音樂系統的教學先告一段落<br>因為繼續完善下去的話，程式的可讀性會降低，現在的音樂系統筆者認為是最純粹，最好理解的了<br>同學們不訪想想該怎麼完善這些問題，我們明天見~</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-10  <a class="commentCountImg" href="/2020/09/10/12thDay10/#comment-container"><span class="display-none-class">3fd637afbdfaed33868a292f1d874c04</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="3fd637afbdfaed33868a292f1d874c04">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>12 分鐘  <i class="fas fa-pencil-alt"> </i>1.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/10/12thDay10/">Day10 - 音樂系統(1)</a></h1><div class="content"><p>昨天我們把架構很籠統的說了大概<br>今天的內容會專注在編程為主，discord.js的元素不會再多贅述<br>可能會比較枯燥一點<br>萬里長路始於足下，同學們加油~</p>
<h2 id="音樂總方法"><a href="#音樂總方法" class="headerlink" title="音樂總方法"></a>音樂總方法</h2><p><img src="https://i.imgur.com/5wwXNdo.png" alt="10-1"></p>
<p>新增一個音樂系統的分類，然後在底下創建MusicFunction方法<br>一併把OnMessage事件下的音樂指令導向這個方法<br>這樣Message事件就不會因為我們的程式碼肥大，進而影響閱讀</p>
<pre><code>function MusicFunction(msg) &amp;#123;
    //將訊息內的前綴字截斷，後面的字是我們要的
    const content = msg.content.substring(prefix[1].Value.length);
    //指定我們的間隔符號
    const splitText = &#39; &#39;;
    //用間隔符號隔開訊息 contents[0] = 指令,contents[1] = 參數
    const contents = content.split(splitText);

    switch (contents[0]) &amp;#123;
        case &#39;play&#39;:
            //點歌&amp;播放歌曲功能
            playMusic(msg, contents);
            break;
        case &#39;replay&#39;:
            //重播當前歌曲
            break;
        case &#39;np&#39;:
            //當前歌曲資訊
            break;
        case &#39;queue&#39;:
            //歌曲清單
            break;
        case &#39;skip&#39;:
            //中斷歌曲
            break;
        case &#39;disconnect&#39;:
            //退出語音頻道並且清空歌曲清單
            disconnectMusic(msg.guild.id, msg.channel.id);
            break;
    &amp;#125;
&amp;#125;
</code></pre>
<p>按照昨天說的，我們分割字串後，用switch case把每個指令獨立出來<br>後面指令也會function化，用呼叫的更加美觀</p>
<h2 id="歌曲指令-play"><a href="#歌曲指令-play" class="headerlink" title="歌曲指令 play"></a>歌曲指令 play</h2><pre><code>//?play
async function playMusic(msg, contents) &amp;#123;
    //定義我們的第一個參數必需是網址
    const urlED = contents[1];
    try &amp;#123;
        //第一個參數不是連結就要篩選掉
        if (urlED.substring(0, 4) !== &#39;http&#39;) return msg.reply(&#39;The link is not working.1&#39;);

        //透過library判斷連結是否可運行
        const validate = await ytdl.validateURL(urlED);
        if (!validate) return msg.reply(&#39;The link is not working.2&#39;);

        //獲取歌曲資訊
        const info = await ytdl.getInfo(urlED);
        //判斷資訊是否正常
        if (info.videoDetails) &amp;#123;
            //指令下達者是否在語音頻道
            if (msg.member.voice.channel) &amp;#123;
                //判斷bot是否已經連到語音頻道 是:將歌曲加入歌單 不是:進入語音頻道並且播放歌曲
                if (!client.voice.connections.get(msg.guild.id)) &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    //進入語音頻道
                    msg.member.voice.channel.join()
                        .then(connection =&gt; &amp;#123;
                            msg.reply(&#39;來了~&#39;);
                            const guildID = msg.guild.id;
                            const channelID = msg.channel.id;
                            //播放歌曲
                            playMusic2(connection, guildID, channelID);
                        &amp;#125;)
                        .catch(err =&gt; &amp;#123;
                            msg.reply(&#39;bot進入語音頻道時發生錯誤，請再試一次&#39;);
                            console.log(err, &#39;playMusicError2&#39;);
                        &amp;#125;)
                &amp;#125; else &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    msg.reply(&#39;已將歌曲加入歌單!&#39;);
                &amp;#125;
            &amp;#125; else return msg.reply(&#39;請先進入頻道:3...&#39;);
        &amp;#125; else return msg.reply(&#39;The link is not working.3&#39;);
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusicError&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<p><img src="https://i.imgur.com/RGusrht.png" alt="10-2"></p>
<p>寫到這會發現需要一個填充歌曲列表的變數，歌曲列表應該是不管到哪一個音樂系統下都可以使用的，所以我們宣告在function外面(全域變數)</p>
<pre><code>//?play 遞迴函式
async function playMusic2(connection, guildID, channelID) &amp;#123;
    try &amp;#123;
        //播放前歌曲清單不能沒有網址
        if (musicList.length &gt; 0) &amp;#123;
            //設定音樂相關參數
            const streamOptions = &amp;#123;
                seek: 0,
                volume: 0.5,
                Bitrate: 192000,
                Passes: 1,
                highWaterMark: 1
            &amp;#125;;
            //讀取清單第一位網址
            const stream = await ytdl(musicList[0], &amp;#123;
                filter: &#39;audioonly&#39;,
                quality: &#39;highestaudio&#39;,
                highWaterMark: 26214400 //25ms
            &amp;#125;)

            //播放歌曲，並且存入dispatcher
            const dispatcher = connection.play(stream, streamOptions);
            //監聽歌曲播放結束事件
            dispatcher.on(&quot;finish&quot;, finish =&gt; &amp;#123;
                //將清單中第一首歌清除
                if (musicList.length &gt; 0) musicList.shift();
                //播放歌曲
                playMusic2(connection, guildID, channelID);
            &amp;#125;)
        &amp;#125; else disconnectMusic(guildID, channelID); //清空歌單並且退出語音頻道
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusic2Error&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<h2 id="歌曲指令-disconnect"><a href="#歌曲指令-disconnect" class="headerlink" title="歌曲指令 disconnect"></a>歌曲指令 disconnect</h2><pre><code>//?disconnect
function disconnectMusic(guildID, channelID) &amp;#123;
    try &amp;#123;
        //判斷bot是否在此群組的語音頻道
        if (client.voice.connections.get(guildID)) &amp;#123;
            //清空歌曲清單
            musicList = new Array();
            //退出語音頻道
            client.voice.connections.get(guildID).disconnect();

            client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;晚安~&#39;));
        &amp;#125; else client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;可是..我還沒進來:3&#39;))
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;disconnectMusicError&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<p>到此，音樂系統的一個基本循環(播放-&gt;退出)就寫完了<br>明天我們繼續完善剩下的功能</p>
<p>以下是今天的程式碼</p>
<pre><code>//#region 全域變數
const Discord = require(&#39;discord.js&#39;);
const client = new Discord.Client();
const ytdl = require(&#39;ytdl-core&#39;);
const auth = require(&#39;./JSONHome/auth.json&#39;);
const prefix = require(&#39;./JSONHome/prefix.json&#39;);

//#endregion

//#region 登入
client.login(auth.key);

client.on(&#39;ready&#39;, () =&gt; &amp;#123;
    console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
&amp;#125;);

//#endregion

//#region message事件入口
client.on(&#39;message&#39;, msg =&gt; &amp;#123;
    //前置判斷
    try &amp;#123;
        if (!msg.guild || !msg.member) return; //訊息內不存在guild元素 = 非群組消息(私聊)
        if (!msg.member.user) return; //幫bot值多拉一層，判斷上層物件是否存在
        if (msg.member.user.bot) return; //訊息內bot值為正 = 此消息為bot發送
    &amp;#125; catch (err) &amp;#123;
        return;
    &amp;#125;

    //字串分析
    try &amp;#123;
        let tempPrefix = &#39;-1&#39;;
        const prefixED = Object.keys(prefix); //前綴符號定義
        prefixED.forEach(element =&gt; &amp;#123;
            if (msg.content.substring(0, prefix[element].Value.length) === prefix[element].Value) &amp;#123;
                tempPrefix = element;
            &amp;#125;
        &amp;#125;);

        //實作
        switch (tempPrefix) &amp;#123;
            case &#39;0&#39;: //文字回應功能
                const cmd = msg.content.substring(prefix[tempPrefix].Value.length).split(&#39; &#39;); //以空白分割前綴以後的字串
                switch (cmd[0]) &amp;#123;
                    case &#39;ping&#39;:
                        msg.channel.send(&#39;pong&#39;);
                        break;
                    case &#39;老婆&#39;:
                        msg.reply(&#39;你沒有老婆!!&#39;);
                        break;
                    case &#39;myAvatar&#39;:
                        const avatar = GetMyAvatar(msg);
                        if (avatar.files) msg.channel.send(`$&amp;#123;msg.author&amp;#125;`, avatar).catch(err =&gt; &amp;#123; console.log(err) &amp;#125;);
                        break;
                &amp;#125;
                break;
            case &#39;1&#39;: //音樂指令
                MusicFunction(msg);
                break;
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;OnMessageError&#39;, err);
    &amp;#125;
&amp;#125;);

//#endregion

//#region 音樂系統

//歌曲清單
let musicList = new Array();

function MusicFunction(msg) &amp;#123;
    //將訊息內的前綴字截斷，後面的字是我們要的
    const content = msg.content.substring(prefix[1].Value.length);
    //指定我們的間隔符號
    const splitText = &#39; &#39;;
    //用間隔符號隔開訊息 contents[0] = 指令,contents[1] = 參數
    const contents = content.split(splitText);

    switch (contents[0]) &amp;#123;
        case &#39;play&#39;:
            //點歌&amp;播放歌曲功能
            playMusic(msg, contents);
            break;
        case &#39;replay&#39;:
            //重播當前歌曲
            break;
        case &#39;np&#39;:
            //當前歌曲資訊
            break;
        case &#39;queue&#39;:
            //歌曲清單
            break;
        case &#39;skip&#39;:
            //中斷歌曲
            break;
        case &#39;disconnect&#39;:
            //退出語音頻道並且清空歌曲清單
            disconnectMusic(msg.guild.id, msg.channel.id);
            break;
    &amp;#125;
&amp;#125;

//?play
async function playMusic(msg, contents) &amp;#123;
    //定義我們的第一個參數必需是網址
    const urlED = contents[1];
    try &amp;#123;
        //第一個參數不是連結就要篩選掉
        if (urlED.substring(0, 4) !== &#39;http&#39;) return msg.reply(&#39;The link is not working.1&#39;);

        //透過library判斷連結是否可運行
        const validate = await ytdl.validateURL(urlED);
        if (!validate) return msg.reply(&#39;The link is not working.2&#39;);

        //獲取歌曲資訊
        const info = await ytdl.getInfo(urlED);
        //判斷資訊是否正常
        if (info.videoDetails) &amp;#123;
            //指令下達者是否在語音頻道
            if (msg.member.voice.channel) &amp;#123;
                //判斷bot是否已經連到語音頻道 是:將歌曲加入歌單 不是:進入語音頻道並且播放歌曲
                if (!client.voice.connections.get(msg.guild.id)) &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    //進入語音頻道
                    msg.member.voice.channel.join()
                        .then(connection =&gt; &amp;#123;
                            msg.reply(&#39;來了~&#39;);
                            const guildID = msg.guild.id;
                            const channelID = msg.channel.id;
                            //播放歌曲
                            playMusic2(connection, guildID, channelID);
                        &amp;#125;)
                        .catch(err =&gt; &amp;#123;
                            msg.reply(&#39;bot進入語音頻道時發生錯誤，請再試一次&#39;);
                            console.log(err, &#39;playMusicError2&#39;);
                        &amp;#125;)
                &amp;#125; else &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    msg.reply(&#39;已將歌曲加入歌單!&#39;);
                &amp;#125;
            &amp;#125; else return msg.reply(&#39;請先進入頻道:3...&#39;);
        &amp;#125; else return msg.reply(&#39;The link is not working.3&#39;);
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusicError&#39;);
    &amp;#125;
&amp;#125;

//?play 遞迴函式
async function playMusic2(connection, guildID, channelID) &amp;#123;
    try &amp;#123;
        //播放前歌曲清單不能沒有網址
        if (musicList.length &gt; 0) &amp;#123;
            //設定音樂相關參數
            const streamOptions = &amp;#123;
                seek: 0,
                volume: 0.5,
                Bitrate: 192000,
                Passes: 1,
                highWaterMark: 1
            &amp;#125;;
            //讀取清單第一位網址
            const stream = await ytdl(musicList[0], &amp;#123;
                filter: &#39;audioonly&#39;,
                quality: &#39;highestaudio&#39;,
                highWaterMark: 26214400 //25ms
            &amp;#125;)

            //播放歌曲，並且存入dispatcher
            const dispatcher = connection.play(stream, streamOptions);
            //監聽歌曲播放結束事件
            dispatcher.on(&quot;finish&quot;, finish =&gt; &amp;#123;
                //將清單中第一首歌清除
                if (musicList.length &gt; 0) musicList.shift();
                //播放歌曲
                playMusic2(connection, guildID, channelID);
            &amp;#125;)
        &amp;#125; else disconnectMusic(guildID, channelID); //清空歌單並且退出語音頻道
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusic2Error&#39;);
    &amp;#125;
&amp;#125;

//?disconnect
function disconnectMusic(guildID, channelID) &amp;#123;
    try &amp;#123;
        //判斷bot是否在此群組的語音頻道
        if (client.voice.connections.get(guildID)) &amp;#123;
            //清空歌曲清單
            musicList = new Array();
            //退出語音頻道
            client.voice.connections.get(guildID).disconnect();

            client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;晚安~&#39;));
        &amp;#125; else client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;可是..我還沒進來:3&#39;))
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;disconnectMusicError&#39;);
    &amp;#125;
&amp;#125;
//#endregion

//#region 子類方法
//獲取頭像
function GetMyAvatar(msg) &amp;#123;
    try &amp;#123;
        return &amp;#123;
            files: [&amp;#123;
                attachment: msg.author.displayAvatarURL(&#39;png&#39;, true),
                name: &#39;avatar.jpg&#39;
            &amp;#125;]
        &amp;#125;;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;GetMyAvatar,Error&#39;);
    &amp;#125;
&amp;#125;

//#endregion
</code></pre>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-09  <a class="commentCountImg" href="/2020/09/09/12thDay9/#comment-container"><span class="display-none-class">ce036539167abed1e5e0efe1e5586862</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="ce036539167abed1e5e0efe1e5586862">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>6 分鐘  <i class="fas fa-pencil-alt"> </i>0.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/09/12thDay9/">Day9 - 註解摺疊與音樂系統介紹</a></h1><div class="content"><p>昨天我們把機器人的架構做了些修改，對功能做了分類<br>今天我們稍微整理一下程式，並且說說音樂系統；<br>如果正在觀看文章的小夥伴不需要音樂系統可以跳過接下來三天的內容，不會影響後續教學的!</p>
<h1 id="region"><a href="#region" class="headerlink" title="region"></a>region</h1><p><img src="https://i.imgur.com/oZB8tKp.png" alt="9-1"></p>
<p>開始寫音樂前，因為程式碼準備要開始增加了<br>筆者先對所有程式做了分類<br>#region<br>#endregion<br>被這兩段覆蓋的程式碼可以摺疊，摺疊後只看的到region後的字</p>
<p><img src="https://i.imgur.com/w6UlfLn.png" alt="9-2"></p>
<p>這個功能必須IDE有支援才可以使用，VSCode支援這個好用的收納方法，所以我們就好好利用一下!</p>
<hr>
<h1 id="函式庫安裝"><a href="#函式庫安裝" class="headerlink" title="函式庫安裝"></a>函式庫安裝</h1><p>那麼我們準備要開始音樂功能了喔!<br>在正式開始撰寫前，我們先開啟終端機<br>依序安裝<br>npm install ffmpeg-static<br>npm install opusscript<br>跟<br>npm install ytdl-core</p>
<p><img src="https://i.imgur.com/zYAoHnj.png" alt="9-3"></p>
<p>記得路徑要在project的根目錄下</p>
<p>這些都是discordBot要播放音樂時需要的插件<br>其中ytdl-core是後續抓取youtube歌曲的library，會需要透過程式來調用<br>所以安裝完之後，我們還要在最上面引用ytdl-core</p>
<p><img src="https://i.imgur.com/zyCqZa8.png" alt="9-4"></p>
<p>這樣一來，撰寫音樂系統的前置作業都算完成了!<br>那麼接下來就該開始撰寫程式囉?nonono</p>
<p>實際上我們在撰寫程式前應該先去參考網路上是否有重複的功能可以參考</p>
<p>既然要寫音樂系統，那當然必需先參考其他人的音樂機器人是怎麼寫的囉!</p>
<hr>
<h1 id="音樂系統整理"><a href="#音樂系統整理" class="headerlink" title="音樂系統整理"></a>音樂系統整理</h1><p>Discord 教學 - 如何簡單加音樂機器人進伺服器 (Rythm)<br><a target="_blank" rel="noopener" href="https://fightwennote.blogspot.com/2018/06/discord-rythm.html">https://fightwennote.blogspot.com/2018/06/discord-rythm.html</a></p>
<p>Rythm是筆者在研究音樂系統前，看過最多次的音樂Bot<br>Rythm的功能非常完善，觀察他的指令對於描繪心目中那個接收音樂指令的Bot架構十分有幫助</p>
<p><img src="https://i.imgur.com/INTGTOT.png" alt="9-5"></p>
<p><img src="https://i.imgur.com/sIgLCsj.png" alt="9-6"></p>
<p>!play (網址)</p>
<p>提供youtube音樂的網址，bot需判斷網址是否符合規範，是不是抓得到歌<br>並且判斷使用者是不是在語音頻道，一切都正常無誤後反饋音樂資訊並且播放歌曲</p>
<p><img src="https://i.imgur.com/XNDlGTj.png" alt="9-7"></p>
<p>!replay</p>
<p>輸入此指令後，讓歌曲重頭開始播放<br>與play一樣，如果使用者不在音樂頻道中，則此指令失效</p>
<p><img src="https://i.imgur.com/rHmPN8m.png" alt="9-8"></p>
<p>!np </p>
<p>顯示當前播放歌曲資訊</p>
<p><img src="https://i.imgur.com/wqhXg2H.png" alt="9-9"></p>
<p>!queue</p>
<p>顯示歌曲清單</p>
<p><img src="https://i.imgur.com/mfzApM9.png" alt="9-10"></p>
<p>!skip</p>
<p>跳過當前播放曲目</p>
<hr>
<p>其他還有循環播放，單曲循環，請機器人退出語音廳等…</p>
<p>我們大概知道了，一個音樂系統需要<br>前綴詞(!)，表示我現在下的指令是音樂系統</p>
<p>音樂指令(play)，表示我在音樂系統中要使用哪一個功能</p>
<p>內容(xxx.com.tw)，不是一定會有，當指定功能需要參數時，我們需要給予他對應的內容</p>
<p>間隔符號(空格) 用來將音樂指令與內容分隔開的決定性符號</p>
<p><img src="https://i.imgur.com/J7cWTuc.png" alt="9-11"></p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-08  <a class="commentCountImg" href="/2020/09/08/12thDay8/#comment-container"><span class="display-none-class">6ba4c5a1bb15a3f406e4b8d629f57a66</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="6ba4c5a1bb15a3f406e4b8d629f57a66">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>6 分鐘  <i class="fas fa-pencil-alt"> </i>0.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/08/12thDay8/">Day8 - 呃...他會需要更多前綴字</a></h1><div class="content"><p>昨天我們對message事件做了完善的前置判斷</p>
<p>如果你做的跟範例一樣，這時我們可以在 ! 後面加入任何字串，來命令機器人做對應的事情</p>
<p>假設之後機器人的指令不斷增加，除了單純的文字回覆，可能還會有查表，投票，管理員指令，權限控制與音樂功能等</p>
<p>這種時候、比起單純的只使用!，機器人支援多種前綴詞顯然是更好的分類手段<br>今天我們進一步修改昨天已經完善的message框架，並且做出音樂功能(假)</p>
<hr>
<p>首先，請幫我在DiscordBot資料夾內新增一個JSONHome資料夾，把auth.json放進去，然後新增一個prefix.json檔</p>
<p><img src="https://i.imgur.com/fW5erlr.png" alt="8-1"><br><img src="https://i.imgur.com/0Io1ydQ.png" alt="8-2"></p>
<p>(prefix.json的內容)</p>
<p>bot.js的最上方幫我加載prefix.json</p>
<p><img src="https://i.imgur.com/0kIli9N.png" alt="8-3"></p>
<p>(auth.json的路徑記得也要一併修改喔!)</p>
<hr>
<p>我們把前綴字整理成了JSONArray物件<br>這樣一來，我們就做到了前綴字的統整，之後不管是新增或調用參數都會方便許多</p>
<p>然後我們把下面的message事件改成這樣</p>
<p><img src="https://i.imgur.com/m35t6Db.png" alt="8-4"></p>
<p>簡單來說就是從原本只判斷驚嘆號，變成只要前綴詞符合prefix.json內的任一Value就給過，並且由tempPrefix來接受符合條件的參數<br>同學們可以參考昨天的範例，來比對每一行的作用。</p>
<p>做到這裡，我們已經可以判斷多種前綴了，不過還沒在實作區判斷成功的是哪一個前綴<br>原本我們打!ping，機器人會回pong<br>現在打@ping也會通過了，如果prefix.json內的值不是@而是#或$$#@#$@甚麼的也一樣，依此類推<br>切割字串的方式也是可以動態化的，不過筆者不在此贅述。<br>我們繼續完善後續判斷</p>
<p><img src="https://i.imgur.com/wpLUo7R.png" alt="8-5"></p>
<p>這樣，如果使用者輸入!xxx，就會進入上方的文字回應功能<br>輸入@xxx，就會進入下方的音樂指令了</p>
<p><img src="https://i.imgur.com/xB8Rpkt.png" alt="8-6"></p>
<hr>
<p>音樂指令的部份我們明天繼續製作，以下是今天的完整程式碼:</p>
<pre><code>const Discord = require(&#39;discord.js&#39;);
const client = new Discord.Client();
const auth = require(&#39;./JSONHome/auth.json&#39;);
const prefix = require(&#39;./JSONHome/prefix.json&#39;);

client.login(auth.key);

client.on(&#39;ready&#39;, () =&gt; &amp;#123;
    console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
&amp;#125;);

client.on(&#39;message&#39;, msg =&gt; &amp;#123;
    //前置判斷
    try &amp;#123;
        if (!msg.guild || !msg.member) return; //訊息內不存在guild元素 = 非群組消息(私聊)
        if (!msg.member.user) return; //幫bot值多拉一層，判斷上層物件是否存在
        if (msg.member.user.bot) return; //訊息內bot值為正 = 此消息為bot發送
    &amp;#125; catch (err) &amp;#123;
        return;
    &amp;#125;

    //字串分析
    try &amp;#123;
        let tempPrefix = &#39;-1&#39;;
        const prefixED = Object.keys(prefix); //前綴符號定義
        prefixED.forEach(element =&gt; &amp;#123;
            if (msg.content.substring(0, prefix[element].Value.length) === prefix[element].Value) &amp;#123;
                tempPrefix = element;
            &amp;#125;
        &amp;#125;);

        //實作
        switch (tempPrefix) &amp;#123;
            case &#39;0&#39;: //文字回應功能
                const cmd = msg.content.substring(prefix[tempPrefix].Value.length).split(&#39; &#39;); //以空白分割前綴以後的字串
                switch (cmd[0]) &amp;#123;
                    case &#39;ping&#39;:
                        msg.channel.send(&#39;pong&#39;);
                        break;
                    case &#39;老婆&#39;:
                        msg.reply(&#39;你沒有老婆!!&#39;);
                        break;
                    case &#39;myAvatar&#39;:
                        const avatar = GetMyAvatar(msg);
                        if (avatar.files) msg.channel.send(`$&amp;#123;msg.author&amp;#125;`, avatar).catch(err =&gt; &amp;#123; console.log(err) &amp;#125;);
                        break;
                &amp;#125;
                break;
            case &#39;1&#39;: //音樂指令
                msg.channel.send(&#39;music&#39;);
                break;
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;OnMessageError&#39;, err);
    &amp;#125;
&amp;#125;);

//獲取頭像
function GetMyAvatar(msg) &amp;#123;
    try &amp;#123;
        return &amp;#123;
            files: [&amp;#123;
                attachment: msg.author.displayAvatarURL(&#39;png&#39;, true),
                name: &#39;avatar.jpg&#39;
            &amp;#125;]
        &amp;#125;;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;GetMyAvatar,Error&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-07  <a class="commentCountImg" href="/2020/09/07/12thDay7/#comment-container"><span class="display-none-class">43982bb76688d25b9fa5ece384a29fa0</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="43982bb76688d25b9fa5ece384a29fa0">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分鐘  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/07/12thDay7/">Day7 - 你的Bot需要一個前綴字</a></h1><div class="content"><p>今天接續昨天的主題，進一步修改message方法</p>
<p>正常我們在Discord上看到別人玩bot的指令都是有一個前綴字，後面附帶著指令的<br>例如: !help $dice</p>
<p>之類的，今天我們要來完成這個需求，並且把前置防呆做好</p>
<p><img src="https://i.imgur.com/biTOOUy.png" alt="7-1"></p>
<p>(終於要開始來爆改啦)</p>
<h2 id="前置判斷"><a href="#前置判斷" class="headerlink" title="前置判斷"></a>前置判斷</h2><p>除了判斷訊息是否是機器人以外，我希望機器人只回應來自群組的消息</p>
<p><img src="https://i.imgur.com/aDj39xo.png" alt="7-2"></p>
<p>因為message物件屬於discord包好給我們的，擔心有哪一層物件的錯誤導致整個機器人崩潰，我希望在前置判斷增加嚴謹性與try catch</p>
<p><img src="https://i.imgur.com/Ic1KoYn.png" alt="7-3"></p>
<p>如果這一段出錯的話，可以在catch中log錯誤訊息喔!</p>
<h2 id="字串分析"><a href="#字串分析" class="headerlink" title="字串分析"></a>字串分析</h2><p>我們希望可以在定義出前置符號後，只接取來自前置符號正確的內容，再判斷後面的內容</p>
<p><img src="https://i.imgur.com/PJZ8fnf.png" alt="7-4"></p>
<h2 id="功能實作"><a href="#功能實作" class="headerlink" title="功能實作"></a>功能實作</h2><p>最後我們把之前的行為修改一下後放回去實作區</p>
<p><img src="https://i.imgur.com/kEshR77.png" alt="7-5"></p>
<p>從原本的if改成switch，這樣我們如果要新增新的判斷式就會快速許多<br>原本判斷的msg.content改成了cmd[0]</p>
<p><img src="https://i.imgur.com/KWR5SHY.png" alt="7-6"></p>
<p>運行一下，結果就跟我們要的一樣了!</p>
<p>最後再稍微加一些範例</p>
<p><img src="https://i.imgur.com/Omv4wA5.png" alt="7-7"><br><img src="https://i.imgur.com/Q3wnJHS.png" alt="7-8"></p>
<hr>
<p>今天的完整程式碼如下</p>
<pre><code>const Discord = require(&#39;discord.js&#39;);
const client = new Discord.Client();
const auth = require(&#39;./auth.json&#39;);

client.login(auth.key);

client.on(&#39;ready&#39;, () =&gt; &amp;#123;
    console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
&amp;#125;);

client.on(&#39;message&#39;, msg =&gt; &amp;#123;
    //前置判斷
    try &amp;#123;
        if (!msg.guild || !msg.member) return; //訊息內不存在guild元素 = 非群組消息(私聊)
        if (!msg.member.user) return; //幫bot值多拉一層，判斷上層物件是否存在
        if (msg.member.user.bot) return; //訊息內bot值為正 = 此消息為bot發送
    &amp;#125; catch (err) &amp;#123;
        return;
    &amp;#125;

    //字串分析
    try &amp;#123;
        const prefix = &#39;!&#39; //前綴符號定義
        if (msg.content.substring(0, prefix.length) === prefix) //如果訊息的開頭~前綴字長度的訊息 = 前綴字
        &amp;#123;
            const cmd = msg.content.substring(prefix.length).split(&#39; &#39;); //以空白分割前綴以後的字串

            //功能實作
            switch (cmd[0]) &amp;#123;
                case &#39;ping&#39;:
                    msg.channel.send(&#39;pong&#39;);
                    break;
                case &#39;老婆&#39;:
                    msg.reply(&#39;你沒有老婆!!&#39;);
                    break;
                case &#39;myAvatar&#39;:
                    const avatar = GetMyAvatar(msg);
                    if (avatar.files) msg.channel.send(`$&amp;#123;msg.author&amp;#125;`, avatar);
                    break;
            &amp;#125;
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;OnMessageError&#39;, err);
    &amp;#125;
&amp;#125;);

//獲取頭像
function GetMyAvatar(msg) &amp;#123;
    try &amp;#123;
        return &amp;#123;
            files: [&amp;#123;
                attachment: msg.author.displayAvatarURL,
                name: &#39;avatar.jpg&#39;
            &amp;#125;]
        &amp;#125;;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;GetMyAvatar,Error&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<p>完工~!</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-06  <a class="commentCountImg" href="/2020/09/06/12thDay6/#comment-container"><span class="display-none-class">b4994363d83eeb8ac52f97ee1bfd4326</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="b4994363d83eeb8ac52f97ee1bfd4326">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>7 分鐘  <i class="fas fa-pencil-alt"> </i>1.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/06/12thDay6/">Day6 - 防呆觀念</a></h1><div class="content"><p>昨天我們大致說明了關於bot.js的運作<br>今天對library文檔做一些補充，以及程序防呆概念</p>
<p>昨天我們介紹bot.js時，有提到client在監聽message事件時，會回傳一message物件</p>
<p><img src="https://i.imgur.com/72h5m9a.png" alt="6-1"></p>
<p>我們將message物件取名為msg，並且從msg中撈出content來檢查訊息內容，用reply來回傳訊息到訊息原本的頻道。</p>
<p>這些功能都可以從library文檔中找到，我們開啟昨天的discord.js文檔，然後在左側的功能列表中找到Message</p>
<p><img src="https://i.imgur.com/UUCJ4Zw.png" alt="6-2"></p>
<p>這就是client監聽事件後帶回給我們的物件了，左側是變數，右側是方法<br>可以看到content在左側，在右側可以找到reply</p>
<p>所以如果要對msg有進一步的調用，我們都必須來看文檔，了解這個library提供了哪些功能給開發者。</p>
<p>在前面，我多次強調client監聽，獲得message事件這件事情<br>discord.js的功能使用是基於物件，也就是想做到甚麼事情、要先了解這件事情該調用哪個物件合適</p>
<p><img src="https://i.imgur.com/g7wSDiK.png" alt="6-3"></p>
<p>這是我們昨天使用的回傳訊息的方式，也是discord.js包好給我們的方式</p>
<p><img src="https://i.imgur.com/qsapj00.png" alt="6-4"></p>
<p>這是透過message物件獲得他所屬的channel(頻道)物件，再指定我要從這個channel底下send(發送)我要發送的訊息。</p>
<p>除非原本要做的行為很簡單，以及需要tag訊息來源user，這種情況才會使用reply<br>不然正常我們是使用msg.channel.send，這種寫法就不會再在訊息前方自動tag使用者了，且傳入的內容也不局限於文字；<br>之後如果要新增甚麼功能，也都是依這個邏輯下去文檔尋找。</p>
<hr>
<p>讓我們回來到今天的主題，我們要稍微的修改一下我們的程式</p>
<p><img src="https://i.imgur.com/gSQ2dXd.png" alt="6-5"></p>
<p>為了讓bot之後更好修改內容，我們將msg.reply統一改成msg.channel.send</p>
<p><img src="https://i.imgur.com/rTgjNW0.png" alt="6-6"></p>
<p>眼尖的同學應該注意到了，筆者除了修改reply以外，還把pong改成ping了<br>這是為了後續的測試，同學們可以運行起來，看看效果</p>
<p><img src="https://i.imgur.com/myPjROx.png" alt="6-7"></p>
<p>機器人的訊息傳送停不下來了!<br>這是因為機器人傳送訊息的同時，也代表著client會再接到一個message事件，這是機器人自己的訊息，同時他也觸發了機器人的下一個訊息回應，這就導致了無限迴圈</p>
<p>同學們可以先在終端機上面用ctrl+c來強制中止程序<br><img src="https://i.imgur.com/vr8LN0C.png" alt="6-8"></p>
<p>那麼，我們該怎麼迴避這個問題呢?</p>
<ul>
<li>讓程序的回應不要跟判斷的句子一樣</li>
<li>判斷訊息來源</li>
</ul>
<p>第一種作法就是說改成像之前一樣ping回pong<br>因為判斷與觸發的句子不一樣，就不會有問題了<br>但如果之後程序變得龐大，或是我們的觸發與回應句可以供其他人添加的話，第一種作法就會比較沒辦法達成我們的需求</p>
<p>第二種作法就是在client監聽到message事件時，先判斷訊息來源是否符合條件，套在現在的問題的話就是我們要判斷是不是bot<br>這樣做，除了我們的程序不會再因為自己的話無限自閉以外，對於有多機器人的群組，也就不會去理會其他機器人的訊息了，大家各自服務。</p>
<p><img src="https://i.imgur.com/tKiHz04.png" alt="6-9"></p>
<p>只要msg.member.user.bot這個參數是true，就代表訊息來自於機器人，不會再處理下面的事情，是不是很簡單呢?</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-05  <a class="commentCountImg" href="/2020/09/05/12thDay5/#comment-container"><span class="display-none-class">9afc8567b573a637950426b179bc26cf</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="9afc8567b573a637950426b179bc26cf">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>8 分鐘  <i class="fas fa-pencil-alt"> </i>1.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/05/12thDay5/">Day5 - 函式庫文檔與基本範例講解</a></h1><div class="content"><p>昨天我們成功叫醒了自己的兒子/女兒</p>
<p>在繼續教育小孩(增加功能)前，今天想說說昨天安裝的discord.js這個工具</p>
<p>該怎麼使用，以及應用後的例子</p>
<p>discord.js是node.js中的一個library，也就是其他人寫好的程式集<br>我們可以安裝他人發佈的程式並且引用，進而降低開發的難度與作業性</p>
<p><a target="_blank" rel="noopener" href="https://discord.js.org/#/">https://discord.js.org/#/</a></p>
<p>這是discord.js的文檔庫，裡面有此庫作者撰寫的使用說明，涵蓋了從以前到現在的發行版本，以及各種小細節</p>
<p>進來後，我們點擊最下面的Get Started</p>
<p><img src="https://i.imgur.com/lzlZZCz.png" alt="5-1"></p>
<p>左側是discord.js的可用資源與方法，預設會在welcome頁面，這裡會介紹discord.js的功能與基本知識，我們先往下拉到 Example usage</p>
<p><img src="https://i.imgur.com/yAsK0m7.png" alt="5-2"></p>
<p>這是discord.js的基本範例，拿來跟昨天的bot.js比對一下，是不是完全一樣呢?<br>只是範例中的 client.login(‘token’); 被我拉上去了；</p>
<p>這是因為在筆者的腦中，給機器人輸入key值是最優先的事情，再來依次進入ready(登入完成)-&gt;message(訊息接收)…不然各區塊的上下順序在這邊其實是沒有差別的。</p>
<p><img src="https://i.imgur.com/JJAMzjd.png" alt="5-3"></p>
<p>下面說回來目前bot.js每一行的功效</p>
<pre><code>const Discord = require(&#39;discord.js&#39;);
</code></pre>
<p>這行的意思是引用discord.js這個工具，然後賦予到Discord這個常數(const)上<br>之後如果要引用discord.js的程式碼，都可以直接調用Discord來實現!</p>
<pre><code>const client = new Discord.Client();
</code></pre>
<p>新宣告一個 Discord(discord.js)下的Client方法，然後將Client方法的結果賦予到client這個常數上<br>之後如果要引用discord.js底下的Client，可以直接呼叫client。</p>
<p>這邊我們額外從Discord中拉出Client()是因為這個client是要用來當bot本體的，也就是我們的遙控器(x</p>
<pre><code>const auth = require(&#39;./auth.json&#39;);
</code></pre>
<p>引用同目錄(./)下的auth.json，賦予給auth這個常數<br>之後想調用auth.json底下的資源，可以直接呼叫auth。</p>
<pre><code>client.login(auth.key);
</code></pre>
<p>執行client的登入行為，登入的key我們放入bot的key</p>
<pre><code>client.on(&#39;ready&#39;, () =&gt; &amp;#123;
    console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
&amp;#125;);
</code></pre>
<p>執行client的監聽(on)行為，要監聽的事件是ready(準備完成)<br>只要client收到ready事件，就執行右邊的箭頭函式( () =&gt; {} )<br>箭頭函式的內容為</p>
<pre><code>console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
</code></pre>
<p>在控制台打印(console.log) 出字串 Logged in as ${client.user.tag}!<br>Logged in as就是單純的字串<br>其中client.user.tag，我們可以從小數點來了解到，user是client底下的一個可用變數，tag則是user底下的一個可用變數<br>最後輸出的結果就是機器人的名字與id<br>如果要仔細了解client的內容物，可以將console.log裡面的東西改成client看看</p>
<pre><code>client.on(&#39;message&#39;, msg =&gt; &amp;#123;
    if (msg.content === &#39;ping&#39;) &amp;#123;
        msg.reply(&#39;pong&#39;);
    &amp;#125;
&amp;#125;);
</code></pre>
<p>監聽client的message(收到訊息)事件，觸發後執行箭頭函式 msg =&gt;{}</p>
<p>這邊的msg是每當client收到message時，discord.js會給予我們的變數，我們將變數稱作msg<br>因為discord.js會回傳的變數是固定的，如果我們這邊像上面一樣寫成() =&gt; {}的話，雖然也可以執行但就不會將discord.js回傳的值再做處理。<br>反過來說，如果我們宣告了msg1跟msg2兩個變數來接回傳值，因為discord.js的message事件並沒有給我們這麼多參數，所以msg2是接收不到東西的</p>
<p>那麼要怎麼知道message事件下到底回傳了哪些參數呢?<br>這就要用到剛剛說的discord.js使用說明書了</p>
<p><a target="_blank" rel="noopener" href="https://discord.js.org/#/docs/main/stable/class/Client?scrollTo=e-message">https://discord.js.org/#/docs/main/stable/class/Client?scrollTo=e-message</a></p>
<p><img src="https://i.imgur.com/mtq2Iqi.png" alt="5-4"></p>
<p>我們監聽message事件的說明在左側元素列表的client分類中的Events中可以找到，可以看到他回傳了 Message Type的變數，而這就是我們接收的內容。</p>
<p>繼續說箭頭函數內要做的事情</p>
<pre><code>if (msg.content === &#39;ping&#39;) &amp;#123;
        msg.reply(&#39;pong&#39;);
    &amp;#125;
</code></pre>
<p>當msg變數底下的content元素，等於ping字串時，執行方法</p>
<pre><code>msg.reply(&#39;pong&#39;);
</code></pre>
<p>使用msg底下的replay方法，並傳入pong字串。</p>
<p>以上的文言文翻譯過來就是<br>機器人(client)接收到訊息(message)的時候，去判斷訊息的內容(content)是不是ping<br>如果是，回傳pong(msg.reply)</p>
<p><img src="https://i.imgur.com/ZZr9Cqx.png" alt="5-5"></p>
<p>先說到這，今天根據程式一行行做解釋，雖然很基本但對第一次觸碰這部分的人來說應該還是有點艱澀</p>
<p>請自行斟酌閱讀即可，明天我們說說如何讓機器人變得更聰明。</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-04  <a class="commentCountImg" href="/2020/09/04/12thDay4/#comment-container"><span class="display-none-class">148d7af4979ffe2a885a8993eb35b91b</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="148d7af4979ffe2a885a8993eb35b91b">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>7 分鐘  <i class="fas fa-pencil-alt"> </i>1.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/04/12thDay4/">Day4 - 機器人的家</a></h1><div class="content"><p>昨天我們成功創建了自己的機器人並且加入群組</p>
<p><img src="https://i.imgur.com/4nFmZyM.png" alt="4-1"></p>
<p>可是機器人加入後怎麼都在睡覺，我怎麼找不到地方操作呢?</p>
<p>那是因為我們昨天做的事情是在Discord申請一個機器人帳戶而已~<br>就像我們的Discord帳戶需要透過Discord登入，Bot其實也需要登入喔</p>
<p>不過Bot的登入路口是要”自己寫”的，今天我們就來叫機器人起床吧!</p>
<hr>
<h1 id="環境安裝"><a href="#環境安裝" class="headerlink" title="環境安裝"></a>環境安裝</h1><p>首先請確保你已經安裝</p>
<p>Node.js<br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10199058">安裝教學</a></p>
<p>Node.js是我們機器人會使用到的後端語言<br>Node.js屬於弱型別語言，相較於其他語言，Node.js編譯前的限制較少，寫起來通常會感到較為自由<br>不過如果對於自己寫的東西不夠了解，弱型別語言並不一定能幫你抓出問題，導致你的問題直到實際運行時才會發生；<br>所以使用Node.js時、知道自己寫的東西具備甚麼效果是重要的</p>
<p>VSCode<br><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">下載路徑</a><br><a target="_blank" rel="noopener" href="https://wcc723.github.io/development/2019/12/01/vscode-chinese/">中文化教學</a></p>
<p>VSCode是筆者愛用的編輯器<br>VSCode本身體積很小，同時又支援許多的擴充套件，上面的中文化教學正是其中之一<br>因此VSCode可以輕鬆的做到客製化，且不改變他的體積簡約。</p>
<p>如果同學們原本就有在使用的編輯器，VSCode可以跳過不安裝</p>
<hr>
<h1 id="蓋一個機器人的家"><a href="#蓋一個機器人的家" class="headerlink" title="蓋一個機器人的家"></a>蓋一個機器人的家</h1><p>首先我們要先替機器人做一個”家”，我們先在自己喜歡的地方建一個資料夾，名字先取作DiscordBot就可以了</p>
<p><img src="https://i.imgur.com/62P5P4i.png" alt="4-2"></p>
<p>一個機器人的家裡面，我們基本需要…<br>機器人的工具箱(node_modules)<br>機器人與工具箱的說明書(package.json)<br>一隻機器人本體(bot.js)<br>門牌號碼(auth.json)<br><img src="https://i.imgur.com/vohV8ms.png" alt="4-3"></p>
<p>像這樣子<br>(看到package-lock.json是你業障重，別刪掉也別管他)</p>
<p>其中，node_modules跟package.json是透過node.js自動生成的，要生成這兩個東西，我們需要先在DiscordBot這個資料夾打開vscode</p>
<p><img src="https://i.imgur.com/WP2M2GQ.png" alt="4-4"><br><img src="https://i.imgur.com/FFxXcMQ.png" alt="4-5"></p>
<p>成功的話，左邊的路徑就會顯示資料夾名稱喔!<br>然後選擇上方的開啟終端機-&gt;新增終端<br>確認終端上面顯示的路徑是正確的後，在終端上面鍵入npm init</p>
<p><img src="https://i.imgur.com/mZhlOAv.png" alt="4-6"></p>
<p>這是node的初始化行為<br>會要你輸入一些關於這個project的基本資料，之後輸出在package.json  </p>
<p><img src="https://i.imgur.com/d095eIo.png" alt="4-7"></p>
<p>就像這樣!</p>
<p>然後我們再手動創建bot.js檔與auth.json檔</p>
<p><img src="https://i.imgur.com/gE4hfc7.png" alt="4-8"></p>
<p><img src="https://i.imgur.com/ObeweYi.png" alt="4-9"></p>
<p>如果說bot.js是機器人的本體，那auth.json就是機器人的內部授權碼<br>auth.json裡面的key代表的是機器人的啟動鑰匙，把鑰匙插進對應的地方才能啟動(有找到bot.js裡面有一行auth.key嗎?)</p>
<p>這邊我們把昨天在bot頁存下來的key放到your key value裡面，注意不要刪掉””</p>
<p>兩個檔案都創建好後記得存檔，我們回到終端機輸入<br>npm install discord.js</p>
<p><img src="https://i.imgur.com/hbEYTK9.png" alt="4-10"></p>
<p><img src="https://i.imgur.com/nIETLkm.png" alt="4-11"></p>
<p>輸入 npm install discord.js後，node.js就會幫我們安裝discord.js這個工具<br>然後把檔案放在node_modules裡面，再到package.json底下紀錄我們使用了哪些工具</p>
<p>沒問題的話，最後我們在終端機輸入node bot</p>
<p><img src="https://i.imgur.com/yEANgJU.png" alt="4-12"></p>
<p><img src="https://i.imgur.com/1Q4C2Q4.png" alt="4-13"></p>
<p>成功!明天我們會再針對今天的程式碼做講解</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-03  <a class="commentCountImg" href="/2020/09/03/12thDay3/#comment-container"><span class="display-none-class">f22a4c3b8696b76904d9ceefed0dd615</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="f22a4c3b8696b76904d9ceefed0dd615">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>3 分鐘  <i class="fas fa-pencil-alt"> </i>0.4 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/03/12thDay3/">Day3 - 你自己的...他叫甚麼名字?</a></h1><div class="content"><p>今天來說說怎麼創建Bot</p>
<p>建立DiscordBot，首先要有一個Discord帳號</p>
<p>到<a target="_blank" rel="noopener" href="https://discordapp.com/developers/applications/">這個網站</a></p>
<p>登入帳號後，右上角會有一個[ New Application ]</p>
<p><img src="https://i.imgur.com/QeKQ4fK.png" alt="NewApplication"></p>
<p>這邊的名字是”應用名稱”<br>同時也會是預設的機器人名稱，仔細想好後就送出吧~</p>
<p><img src="https://i.imgur.com/kXSwy3I.png" alt="basicUI"></p>
<p>送出後就會進來應用介面了</p>
<p>點擊頭像可替換應用的大頭貼，名字就是你剛剛取的</p>
<p>都設定好之後，我們點選左邊列表第三排的Bot</p>
<p><img src="https://i.imgur.com/r1NSe8O.png" alt="BotUI"></p>
<p>第一次點應該會問你是否要建立，點選是<br>這樣Discord就會幫你的機器人實際創建一個帳戶<br>點擊右邊TOKEN底下的Copy，他會給你一組很長的亂碼</p>
<h2 id="先存在記事本，我們明天會用到"><a href="#先存在記事本，我們明天會用到" class="headerlink" title="先存在記事本，我們明天會用到"></a><strong>先存在記事本，我們明天會用到</strong></h2><hr>
<p>接下來我們點左邊的OAuth2</p>
<p><img src="https://i.imgur.com/o5eSFy6.png" alt="Oauth2UI"></p>
<p>這是創建邀請連結的地方，SCOPES欄的部份點Bot，這樣下面就會出現第二欄<br>下面是要給予機器人在群組內的權限，需要根據Bot實際上具備哪些功能，來判斷需要給予哪些權限<br>如果不知道怎麼用，先選Administrator就可以了。</p>
<p>都做完後，中間的就會有完整的邀請連結，請複製後輸入在瀏覽器上</p>
<p><img src="https://i.imgur.com/9oCUzUZ.png" alt="url"></p>
<p>使用此連結，就可以把Bot拉入你的群組內，前提是你在此群組有管理者權限喔</p>
<p><img src="https://i.imgur.com/nJ3jUuW.png" alt="su"></p>
<p>喔耶，成功了!</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-02  <a class="commentCountImg" href="/2020/09/02/12thDay2/#comment-container"><span class="display-none-class">ec844c5fa4ec6cb49a167ce31f39f40c</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="ec844c5fa4ec6cb49a167ce31f39f40c">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分鐘  <i class="fas fa-pencil-alt"> </i>0.7 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/02/12thDay2/">Day2 - DiscordBot - 小愛麗絲</a></h1><div class="content"><p>在今天的文章開始前，想先跟大家介紹我家的女兒</p>
<p><img src="https://i.imgur.com/jnSGjxu.png" alt="小愛麗絲"><br><a target="_blank" rel="noopener" href="https://supr.link/COL1X">我是連結</a></p>
<p>小愛麗絲，生日是2020年6月1日</p>
<p>明明感覺已經做了很久，其實是六月時才開始做到現在</p>
<p>興趣是吐槽別人，喜歡唱歌，希望大家能多多認識她</p>
<p>這篇鐵人賽的文章內容基本會依照小愛麗絲現有的功能做講解，需要範例時可以參考看看~</p>
<hr>
<p>那麼，今天主要是要來講講本次鐵人賽的大鋼</p>
<p>關於一個機器人，為什麼想要做機器人，該做哪些功能，以及後台零負擔是甚麼意思等</p>
<p>哼哼，很好奇吧</p>
<p>這麼重要的問題就要從最開始講起，各位客官且聽我娓娓道來</p>
<p>程式的產生是建立在需求上的，就像人需要吃早餐所以這世界上有了早餐店</p>
<p>我希望可以製作一隻Bot供我認識的人們娛樂，所以小愛麗絲誕生了</p>
<p>最初，小愛只會針對2~3個句子回應固定的答案</p>
<p><img src="https://i.imgur.com/cew9uKd.png" alt="解放"> </p>
<p>想供大家娛樂-&gt;小愛學會說話</p>
<hr>
<p>大家希望可以教小愛說話，不再是我自己新增，小愛開始學會不同的詞</p>
<p> <img src="https://i.imgur.com/r7sSFlZ.png" alt="teach"></p>
<p>出現了希望新增詞彙的聲音-&gt;所以小愛開始背單字</p>
<hr>
<p>跟朋友的認識是圍繞著某款遊戲，為了讓查詢遊戲資料方便，希望小愛能幫忙查表</p>
<p> <img src="https://i.imgur.com/MZNmVDc.png" alt="查表"></p>
<p>想在聊天時可以直接找資料-&gt;增加爬蟲功能</p>
<hr>
<p>因為後來指令增加，為了方便閱讀所以增加說明書</p>
<p><img src="https://i.imgur.com/FxYPkWv.png" alt="help"></p>
<p>其他還有音樂，圖片，權限控制等等…</p>
<hr>
<p>舉了些例子，想說的是、機器人的功能是多樣化的，想做甚麼取決於需求；<br>本文會圍繞著Node.js該如何製作一隻機器人為主軸，分享目前的程式寫法&amp;講解<br>以及如何做到24HR的主機&amp;資料庫託管等</p>
<p>礙於篇幅限制，之後文章沒辦法把機器人的功能一個一個寫成教學，有特別希望學甚麼的話再問看看吧~</p>
<p>最後，希望各位有空可以多跟小愛聊天，我們明天見~</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><!--!--><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/2/">上一頁</a></div><div class="pagination-next"><a href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/4/">下一頁</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">1</a></li><li><a class="pagination-link" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/2/">2</a></li><li><a class="pagination-link is-current" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/3/">3</a></li><li><a class="pagination-link" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/62000156" alt="微笑の家"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">微笑の家</p><p class="is-size-6 is-block">請給予我拯救他人的力量</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>台灣</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">36</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分類</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">標籤</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/NALocal" target="_blank" rel="noopener">關注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/NALocal"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://www.facebook.com/profile.php?id=100003120783130"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:lion31lion31@gmail.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"來源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新評論</h3><span class="body_hot_comment">加載中，最新評論有1分鐘緩存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-14T04:00:00.000Z">2021-12-14</time></p><p class="title"><a href="/2021/12/14/racingScript-worldFlipper/">競速疊屍腳本 - 台版彈射世界</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-16T04:00:00.000Z">2021-11-16</time></p><p class="title"><a href="/2021/11/16/fluidThemeShare/">fluid支持pjax主題源碼分享</a></p><p class="categories"><a href="/categories/hexo%E4%B8%BB%E9%A1%8C%E5%88%86%E4%BA%AB/">hexo主題分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-16T02:00:00.000Z">2021-11-16</time></p><p class="title"><a href="/2021/11/16/live2DShareList/">公開Live2D模型蒐集分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-27T05:47:20.000Z">2021-09-27</time></p><p class="title"><a href="/2021/09/27/aboutDiscordJs13/">關於discord.js升級至13版本</a></p><p class="categories"><a href="/categories/BaseDiscordBot/">BaseDiscordBot</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-16T05:57:00.000Z">2021-09-16</time></p><p class="title"><a href="/2021/09/16/hello-smile/">你好，微笑之家</a></p><p class="categories"><a href="/categories/%E6%97%A5%E8%A8%98/">日記</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分類</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/BaseDiscordBot/"><span class="level-start"><span class="level-item">BaseDiscordBot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/hexo%E4%B8%BB%E9%A1%8C%E5%88%86%E4%BA%AB/"><span class="level-start"><span class="level-item">hexo主題分享</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%97%A5%E8%A8%98/"><span class="level-start"><span class="level-item">日記</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/"><span class="level-start"><span class="level-item">鐵人賽</span></span><span class="level-end"><span class="level-item tag">31</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/"><span class="level-start"><span class="level-item">用Node.js製作後台零負擔的DiscordBot</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">歸檔</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">標籤</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/bot/"><span class="tag">bot</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/discord/"><span class="tag">discord</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/discord-js/"><span class="tag">discord.js</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node-js/"><span class="tag">node.js</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%99%E5%AD%B8/"><span class="tag">教學</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/"><span class="tag">12th鐵人賽</span><span class="tag is-grey-lightest">31</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E8%A8%98/"><span class="tag">日記</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Live2D/"><span class="tag">Live2D</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fluid/"><span class="tag">fluid</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BD%88%E5%B0%84%E4%B8%96%E7%95%8C/"><span class="tag">彈射世界</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%85%B3%E6%9C%AC/"><span class="tag">腳本</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%81%8A%E6%88%B2/"><span class="tag">遊戲</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">訂閱更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="訂閱"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="微笑家" height="28"></a><p class="size-small"><span>&copy; 2021 NALocal</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版權說明：[本網站所有內容均收集於互聯網或自己創作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便於網友與自己學習交流，如有侵權，請<a href="/message" target="_blank">留言</a>，立即處理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已運行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小時 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！ ❤️";
        }var now = new Date();setInterval("createTime('2021/09/15 18:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感謝 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光臨！ ❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/NALocal/NALocal.github.io"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="/dist/APlayer.min.css"><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-TW");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到頂端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('9a33a548232178c23121','bbdfbe2d45288ac4b37a315cb1aa7c1a50dd9fa6','NALocal','nalocal.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什麼..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什麼...","untitled":"(無標題)","posts":"文章","pages":"頁面","categories":"分類","tags":"標籤"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('9a33a548232178c23121','bbdfbe2d45288ac4b37a315cb1aa7c1a50dd9fa6','NALocal','nalocal.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>