<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>微笑家</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="微笑家"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="微笑家"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="程式教學 C#&amp;#x2F;JAVA&amp;#x2F;HTML5&amp;#x2F;NODE.JS，永恆的願望"><meta property="og:type" content="blog"><meta property="og:title" content="微笑の家"><meta property="og:url" content="https://nalocal.github.io/"><meta property="og:site_name" content="微笑の家"><meta property="og:description" content="程式教學 C#&amp;#x2F;JAVA&amp;#x2F;HTML5&amp;#x2F;NODE.JS，永恆的願望"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://avatars.githubusercontent.com/u/62000156"><meta property="article:author" content="NALocal"><meta property="article:tag" content="程式,教學,程式教學,C,C#,JAVA,HTML,HTML5,NODE,NODE.JS,JAVASCRIPT,CSS,SCSS,SASS,DISCORD,BOT,BLOG,心得,SMILE,NALOCAL,NA,IT,BACK,END,BackEnd,後端,hexo,fluid,pjax,微笑,微笑之家,微笑家"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://avatars.githubusercontent.com/u/62000156"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://nalocal.github.io/blog"},"headline":"微笑家","image":["https://nalocal.github.io/img/og_image.png"],"author":{"@type":"Person","name":"NALocal"},"description":"程式教學 C#&#x2F;JAVA&#x2F;HTML5&#x2F;NODE.JS，永恆的願望"}</script><link rel="icon" href="/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/atom.xml" title="微笑家" type="application/atom+xml">
</head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="微笑家" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/album">Album</a><a class="navbar-item" href="/friend">Friend</a><a class="navbar-item" href="/message">Message</a><a class="navbar-item" href="/self-talking">Self-talking</a><a class="navbar-item" href="/music">Music</a><a class="navbar-item" href="/media">Media</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-16  <a class="commentCountImg" href="/2020/09/16/12thDay16/#comment-container"><span class="display-none-class">1bf09b41e517acee57aa8bbb592632b7</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="1bf09b41e517acee57aa8bbb592632b7">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>10 分鐘  <i class="fas fa-pencil-alt"> </i>1.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/16/12thDay16/">Day16 - 選擇你的資料庫</a></h1><div class="content"><p>昨天我們成功把機器人丟到雲端託管，現在機器人可以..</p>
<ul>
<li>24小時不關機的回應大家的文字</li>
<li>24小時不關機的播放音樂</li>
<li>24小時不關機的做任何你已經自己寫好的原創功能!</li>
</ul>
<p>也就是說，原本機器人是前端(Discord)與後端(你的電腦)</p>
<p>現在是前端(Discord)與後端(Heroku)了，儼然是一個自成循環的軟體，自行運作<br>只要不是要更新以及沒有重大bug的話，便可以減少維護，只要當一個使用者就好</p>
<p>不過這樣的架構實際上是不夠完整的，Day14我們有帶到，關於面向使用者的軟體，通常會有</p>
<ul>
<li>前端</li>
<li>後端</li>
<li>與資料庫</li>
</ul>
<p>目前我們還缺乏一個資料庫，如果是之前在本機的情況，本文章只要教各位怎麼安裝MySQL就好；但是現在機器人已經被推上Heroku了，我們對對方的主機又沒有完全的控制權限，這又該怎麼辦呢?</p>
<hr>
<h2 id="Heroku的資料庫"><a href="#Heroku的資料庫" class="headerlink" title="Heroku的資料庫"></a>Heroku的資料庫</h2><p>我們來介紹Heroku的資料庫吧<br>因為這東西筆者的了解也不深，只是有必要提到<br>如果介紹有錯還望各位指正，以免誤導到人，感謝^^”</p>
<p>Heroku不只提供軟體&amp;網站的上傳發佈，同時也支援這些程式在Heroku專案的主機上建立專屬的本地資料庫<br>其主要使用PostgreSQL，是一種關聯性資料庫<br>關聯性資料庫是甚麼?你當成MySQL就好，總之就是相對嚴謹(麻煩)的一種資料庫語言</p>
<p><img src="https://i.imgur.com/COzboBR.png" alt="16-1"> </p>
<p>免費的Heroku Postgre提供1萬則的資料容量，只要你創建的DB總資料量超過這個數字後便無法寫入，並且會跟你收費以提高額度來支援更多的資料寫入量</p>
<p>1萬這個數字說大不大說小不小，雖然說對於個人戶是夠用了，但如果長久維運，缺乏資料管理、造成資料堆積<br>又或是資料儲存的方式比較複雜，紀錄一次可能就會占用許多空間的話…實際上筆者覺得1萬行是完全不夠Bot使用的</p>
<p>而且因為Heroku的操作都必須透過指令，只是程式的操作可能還好，在處理資料庫這種複雜的系統時，不自己寫一個圖形介面真的很難管理</p>
<h2 id="替代方案"><a href="#替代方案" class="headerlink" title="替代方案"></a>替代方案</h2><p>結合上述，我們整理出Heroku 原生資料庫的兩大問題</p>
<ul>
<li>免費容量低</li>
<li>管理困難</li>
</ul>
<p>筆者Bot的製作訴求是自動、便利、好維護<br>如果使用Heroku資料庫的話還要擔心或許哪天Heroku會忽然想不開，去更新他們的資料庫語法…這與筆者的需求是完全背道而馳的</p>
<p>因此，我們需要一個替代方案，這個做法就是GoogleAppsScript !</p>
<p><img src="https://i.imgur.com/w7gmbo5.jpg" alt="16-2"> </p>
<p>GoogleAppsScript，簡稱GAS，不是容易爆炸的那個</p>
<p>GAS是Google提供的一種程式檔，他使用JavaScript語言，並且自動引用Google提供的函式庫</p>
<p>因為是Google自家產品，理所當然的，GAS可以輕鬆的調用Google旗下產品的資訊(例如Google文件，試算表等)</p>
<p>並且GAS是一種存於Google雲端的程式，只要他正式發佈便也會是24小時自動運作的程序，不會消耗到筆者一毛錢!(重點)</p>
<h2 id="GAS的規格"><a href="#GAS的規格" class="headerlink" title="GAS的規格"></a>GAS的規格</h2><p><img src="https://i.imgur.com/wLtCjIq.png" alt="16-3"> </p>
<p>在本主題，我們將用試算表來儲存資料<br>藉由GAS來編寫API，供Bot調用&amp;獲取資料</p>
<p>上圖是GAS提供給使用者做各種操作的具體上限，我們看第一行的基本使用者(gmail.com)即可</p>
<p>Properties read/write(屬性讀寫)<br>上限50000筆/天</p>
<p>URL Fetch calls(URL調用)<br>上限20000筆/天</p>
<p>先看URL Fetch calls，這句的意思是關於Bot一天內調用API的上限次數<br>如果Bot一天內對API的請求超過2萬次，Google就會中斷你的請求、並且給你一個大大的Error</p>
<p>Properties read/write代表的是你的程序對試算表讀寫的次數上限<br>如果我的API被呼叫一次，程序就會對試算表做50000次的讀取，那這個API只要調用一次，今天的扣打就用完了(x</p>
<p>這樣，我們得出一個結論<br>理論上，只要我的每個API內讀寫資料的次數平均介於2~3次<br>那我們一天的資料請求上限就會足足有2萬筆，直接是Heroku總上限的兩倍!</p>
<p>當然這種做法也有他的弊端，Heroku的上限是總儲存上限，而我們的GAS上限是總調用上限<br>雖然隔天次數就會給你加滿，但只要我調用的次數足夠頻繁，理論上每天都會面臨資料無法再調用的問題，對於如何減少機器人的資料調用會需要做些功夫</p>
<p>遠水救不了近火，試算表資料的調用途中經過GAS，再從住在Heroku的bot程序發送API跟GAS要資料<br>速度理所當然沒有像使用Heroku Postgre一樣即時</p>
<p>因為試算表非正統SQL，SQL是一種專門為讀/寫資料做優化的體系；當資料量大到一個程度時，效能一定沒有SQL好</p>
<p>但同時GAS的好處也很明顯</p>
<p>資料的儲存幾乎是無上限的<br>Google自帶的使用者介面讓管理十分容易，相對不用擔心資料備份等問題<br>新增刪除資料的方式都會比Heroku Postgre來的更加直觀<br>不用擔心未來因為GoogleAppsScript改版，資料會很難帶走，替代方案也多的是</p>
<p>以上，便是筆者針對資料庫方案取捨的介紹<br>明天我們著手開始編寫基本的試算表資料跟GAS</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-15  <a class="commentCountImg" href="/2020/09/15/12thDay15/#comment-container"><span class="display-none-class">dd717df44a3194cbb5ee944b8353c46b</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="dd717df44a3194cbb5ee944b8353c46b">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>8 分鐘  <i class="fas fa-pencil-alt"> </i>1.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/15/12thDay15/">Day15 - Heroku架設&amp;細部設定</a></h1><div class="content"><p>早安<br>昨天我們把Heroku跟Git都安裝好了，今天我們要將我們的專案變成Git專案<br>並且推上Heroku</p>
<h1 id="第一次推送專案"><a href="#第一次推送專案" class="headerlink" title="第一次推送專案"></a>第一次推送專案</h1><p>首先，跟之前一樣<br>我們先用VSCode開啟專案資料夾</p>
<p><img src="https://i.imgur.com/ACltFP5.png" alt="15-1"></p>
<p>確定終端機路徑正確後，輸入<br>git init</p>
<p><img src="https://i.imgur.com/7aVXFF2.png" alt="15-2"></p>
<p>左側的檔案都變得綠綠的<br>如果你有看的到隱藏資料夾的話，在專案底下還會看到一個.git的隱藏資料夾<br>那就是用來識別git專案的檔案，也是執行git語言時的依據</p>
<p>這樣專案就轉換成git專案了，然後我們接下來要在heroku上創建一個專案庫<br>專案名稱的命名方式大多為 aaa-bbb-ccc<br>第一個字必須為小寫，且不能與其他在heroku上的專案撞名，所以越獨特越好<br>這邊筆者的專案名稱取做 the-bot-alice-on-heroku<br>我們輸入<br>heroku create 你的專案名稱</p>
<p><img src="https://i.imgur.com/rpv8elG.png" alt="15-3"></p>
<p>這時候如果到這裡看，成功的話就會看到剛剛創建的專案了<br><a target="_blank" rel="noopener" href="https://dashboard.heroku.com/">https://dashboard.heroku.com/</a></p>
<p><img src="https://i.imgur.com/KXLt0MO.png" alt="15-4"></p>
<p>我們繼續輸入</p>
<p>git add .<br>git commit -m init<br>git push heroku master</p>
<p><img src="https://i.imgur.com/FJAbH1V.png" alt="15-5"></p>
<p>最後有看到Build succeeded就是成功了!<br>這三個指令的意思依序是</p>
<p>git add .<br>將目錄下的所有檔案加入git控管</p>
<p>git commit -m init<br>將git控管下的檔案全部加入本次要推送的版本，因為是第一次推送所以是init，之後第n次推送的話程式碼要改成 git commit -m ‘版本說明’</p>
<p>git push heroku master<br>將commit起來的版本推送(上傳)到heroku的主分支，總之就是上傳檔案</p>
<p>所以之後如果要更新程式，都是依序使用這三個命令來上傳機器人</p>
<p>接著我們運行看看<br>heroku logs –t</p>
<p><img src="https://i.imgur.com/BezAjQn.png" alt="15-6"></p>
<p>這是呼叫heroku的控制後台，相當於在看遠端主機運行程序時的終端機<br>要退出時按ctrl+c退出</p>
<p>可以看到對方也接收到我們上傳的檔案，有一個Build succeeded<br>但是後面都是npm ERR<br>以及可以看到他嘗試使用 npm start 來運行我們的專案<br>還記得我們的程序啟動試透過甚麼方式嗎?<br>沒錯，node bot!</p>
<h1 id="平台設定"><a href="#平台設定" class="headerlink" title="平台設定"></a>平台設定</h1><p>我們在專案的根目錄新增一個檔案，取名叫做Procfile</p>
<p><img src="https://i.imgur.com/4Xl8BEd.png" alt="15-7"></p>
<p>裡面只有一行，寫上<br>worker: node bot</p>
<p>可以看到，檔案在取名為Procfile後，icon會變成Heroku的標誌<br>這是Heroku可以辨識的檔案，作用是指定Heroku的啟動命令<br>worker是代表我們要運行的啟動命令是worker(程序)<br>heroku預設的啟動命令屬於web(網頁)</p>
<p>寫好後，我們再做一次推送<br>git add .<br>git commit -m ‘npm bot’<br>git push heroku master</p>
<p><img src="https://i.imgur.com/foAIKIR.png" alt="15-8"></p>
<p>push完，我們打開網頁，回到heroku控制台，進入我們的專案</p>
<p><img src="https://i.imgur.com/gLPqwGs.png" alt="15-9"></p>
<p>會看到，紅框處是我們的推送日誌，這也是用git來控管程式時的日誌檔</p>
<p>藍框就顯示了我們程序的啟動方式，可以看到node bot已經出現在上面了，但是沒有開啟</p>
<p>我們點擊紫框的Resources</p>
<p><img src="https://i.imgur.com/s2C5V61.png" alt="15-10"></p>
<p>將 npm start給關閉，node bot開啟，這樣回去主頁面看node bot也會是開啟的狀態了</p>
<p>最後我們在終端機輸入 heroku restart</p>
<p><img src="https://i.imgur.com/10oZqCf.png" alt="15-11"></p>
<p>這是重啟專案的指令，當程序崩潰或是遇到任何問題時，都可以重啟看看</p>
<p>heroku logs -t</p>
<p><img src="https://i.imgur.com/ZVirlHw.png" alt="15-12"> </p>
<p><img src="https://i.imgur.com/SrXdjRa.png" alt="15-13"></p>
<p>成功!<br>到此為止，我們成功將Bot推送到Heroku上，以後不用我們自己運行<br>機器人也會是24小時運行了，給做到這邊的自己一個鼓勵吧^^</p>
<h1 id="其他設定"><a href="#其他設定" class="headerlink" title="其他設定"></a>其他設定</h1><p>Heroku的免費時數預設是550小時/月，如果說是自己幾個朋友使用是沒關係<br>當機器人在一個人數比較多的群組時，550小時是沒辦法支撐1個月的，每到月底、機器人就會想休息幾天</p>
<p>但是!如果你有在Heroku的帳戶綁定信用卡的話，他會免費再給你450小時，每個月的免費時數會變成1000小時，運行機器人是完全足夠的!不用擔心會扣款</p>
<p>我們點選右上角的設定</p>
<p><img src="https://i.imgur.com/84iDGli.png" alt="15-14"></p>
<p>點Billing，然後點Add credit card</p>
<p><img src="https://i.imgur.com/Rqh5IfU.png" alt="15-15"></p>
<p>再來就是綁卡流程，相信這部份不用截圖，各位自己會的</p>
<p><img src="https://i.imgur.com/A1PkaAG.png" alt="15-16"></p>
<p>綁完後，底下原本的550小時就會變成有1000小時的扣打了~</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-14  <a class="commentCountImg" href="/2020/09/14/12thDay14/#comment-container"><span class="display-none-class">c805e0959f10d40c1199d2d8d2df5a99</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="c805e0959f10d40c1199d2d8d2df5a99">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>9 分鐘  <i class="fas fa-pencil-alt"> </i>1.4 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/14/12thDay14/">Day14 - Heroku與Git，介紹與安裝</a></h1><div class="content"><p>好勒，上禮拜我們終於把基本的音樂系統做好<br>現在你的機器人支援多種功能，加上你自己做的其他系統，已經是一個強大的機器人了!</p>
<p>之後如果我要使用機器人，只要打開cmd運行node bot，然後電腦一直開著就好</p>
<ul>
<li>一直開著就好</li>
<li>自己不在其他人就沒辦法使用bot</li>
<li>程序如果掛掉要自已重啟</li>
</ul>
<p>其實這就是將自己的電腦做為後端主機在運行bot<br>而這方法對於平常沒有長時間開機習慣的使用者來說是略為有些負擔了<br>就算是順便開著也要擔心程式會不會自己崩潰跳閘</p>
<p>也因此，今天我們就會來解決這個問題，同時也是終於能提到我們的主題啦</p>
<hr>
<h1 id="後端0負擔"><a href="#後端0負擔" class="headerlink" title="後端0負擔"></a>後端0負擔</h1><p>一個面向使用者的服務都會有<br>一個前端視覺介面(Discord)<br>一個後端(bot.js)<br>再在後端的後面獨立出一個資料庫主機就更好了(SQL)</p>
<p>後端0負擔的意思是我們不必再支付運行程序的電費等維護費用<br>那麼該怎麼做才能實現呢?其實也很簡單，我們把程序給其他人的電腦跑，讓他幫你管就好，也就是</p>
<h3 id="雲端託管"><a href="#雲端託管" class="headerlink" title="雲端託管"></a>雲端託管</h3><p><img src="https://i.imgur.com/7OKEagE.png" alt="14-1"></p>
<p><a target="_blank" rel="noopener" href="https://www.heroku.com/">Heroku官方網站</a></p>
<p>Heroku是支援多語言的全自動託管平台<br>只要將你的程序放上去並且做好相關設定，程序就會在他們的主機上自動運行</p>
<h1 id="註冊Heroku帳號"><a href="#註冊Heroku帳號" class="headerlink" title="註冊Heroku帳號"></a>註冊Heroku帳號</h1><p>請先到<a target="_blank" rel="noopener" href="https://signup.heroku.com/login">這個網址</a>註冊帳號資訊</p>
<p><img src="https://i.imgur.com/7PeESWm.png" alt="14-2"></p>
<p>First name姓<br>Last name名<br>Email Address信箱<br>Role職業<br>Primary Development Language開發語言</p>
<p>基本上只要信箱跟開發語言沒打錯選錯就好，填好後我們直接送出</p>
<p><img src="https://i.imgur.com/N7yKXIJ.png" alt="14-3"></p>
<p>到這個步驟就代表前面填的資料ok，請去收信</p>
<p><img src="https://i.imgur.com/GeRJh01.png" alt="14-4"></p>
<p>點擊信中的連結</p>
<p><img src="https://i.imgur.com/oVhFOKt.png" alt="14-5"></p>
<p>這邊他要你重複輸入密碼，需8碼，由英數符號組成</p>
<p><img src="https://i.imgur.com/1PBEoJs.png" alt="14-6"></p>
<p>一路確認後就會來到這裡了<br>這裡是heroku的後台，左側是創建我們的應用程序專案，右側是成立小組</p>
<p>不過我們通常會透過 Heroku CLI 來操作，所以不用管這兩個東東，我們繼續做</p>
<h1 id="安裝Heroku-CLI"><a href="#安裝Heroku-CLI" class="headerlink" title="安裝Heroku CLI"></a>安裝Heroku CLI</h1><p>點擊<a target="_blank" rel="noopener" href="https://devcenter.heroku.com/articles/heroku-cli#windows">這個網址</a></p>
<p>按照你的作業系統安裝對應的版本，通常是Windows 64-bit</p>
<p><img src="https://i.imgur.com/j8Nhzgo.jpg" alt="14-7"></p>
<p>一路next就好，最後Close</p>
<p>最後我們開啟終端機(cmd)，注意必須是重新開啟的cmd，安裝前已經開啟的不行<br>在上面輸入heroku<br><img src="https://i.imgur.com/Q5PDR5H.png" alt="14-8"></p>
<p>只要出現類似這樣的畫面就代表安裝成功了<br>如果沒有成功出現，可以先重開機看看，再不然可能是你的安裝版本有錯，電腦不是64位元等</p>
<p>成功的話我們繼續輸入 heroku login</p>
<p><img src="https://i.imgur.com/4riBzSS.png" alt="14-9"></p>
<p>在鍵盤上輸入除了q以外的按鍵 = 同意他開啟瀏覽器提供登入</p>
<p><img src="https://i.imgur.com/hIbxrs0.png" alt="14-10"></p>
<p><img src="https://i.imgur.com/yUICBY3.png" alt="14-11"></p>
<p>chrome會自動打開，因為我們前面剛在heroku註冊，所以網頁還存著登入訊息，直接按Log In，回頭看cmd就會顯示登入成功了!</p>
<p>這樣Heroku CLI就裝好了，我們再來安裝Git</p>
<h1 id="Git安裝"><a href="#Git安裝" class="headerlink" title="Git安裝"></a>Git安裝</h1><p>Git是一種提供程式版本控制的語言，最常見的例子是GitHub<br>透過Git語言，我們可以將專案製作成Git專案，然後透過Git將程式推送到雲端，並且保證每個版本間的修改與來源都得到紀錄</p>
<p>Heroku正是依循Git的規則來上傳下載程式</p>
<p>點擊<a target="_blank" rel="noopener" href="https://git-scm.com/download/win">這個網址</a></p>
<p>一樣選擇對應的版本<br>安裝時的選項很多，請跟我底下的圖片選擇一樣</p>
<p><img src="https://i.imgur.com/DprmCvj.jpg" alt="14-12"></p>
<p><img src="https://i.imgur.com/Y0z1v5M.jpg" alt="14-13"></p>
<p>路徑跟我不一樣沒關係，總之要照他預設給你的，不要改</p>
<p><img src="https://i.imgur.com/MqCh8g0.jpg" alt="14-14"> </p>
<p><img src="https://i.imgur.com/jsvzoZd.jpg" alt="14-15"></p>
<p><img src="https://i.imgur.com/TlaJ0d8.jpg" alt="14-16"></p>
<p><img src="https://i.imgur.com/ME0BGhq.jpg" alt="14-17"></p>
<p><img src="https://i.imgur.com/NnHcvxN.jpg" alt="14-18"></p>
<p><img src="https://i.imgur.com/EJs2X40.jpg" alt="14-19"></p>
<p><img src="https://i.imgur.com/aw4G31d.jpg" alt="14-20"></p>
<p><img src="https://i.imgur.com/ZJTODzR.jpg" alt="14-21"></p>
<p>這樣就安裝好Git了，跟剛剛一樣，我們開一個新的cmd測試是否安裝成功</p>
<p><img src="https://i.imgur.com/cG2Rs1B.png" alt="14-22"></p>
<p>失敗的話，除了版本問題以外，有可能是PATH檔不正確，可以拿這個keyword去排除問題試試看</p>
<p>都沒問題的話，我們輸入以下兩個指令</p>
<p>git config –global user.name “smile”<br>git config –global user.email “<a href="mailto:&#x61;&#x32;&#56;&#56;&#50;&#x36;&#x32;&#53;&#50;&#x32;&#x35;&#50;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#x6d;">&#x61;&#x32;&#56;&#56;&#50;&#x36;&#x32;&#53;&#50;&#x32;&#x35;&#50;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#x6d;</a>“</p>
<p><img src="https://i.imgur.com/VMeScbF.png" alt="14-23"></p>
<p>這是設定你的使用者名稱與信箱<br>我的名稱是smile，你要改成你自己的稱呼，信箱與heroku一樣就可以了</p>
<p>之後透過git推送時，都會以這個稱呼與信箱來識別<br>這樣Heroku跟Git的前置作業都做好了，明天將專案推上Heroku</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-13  <a class="commentCountImg" href="/2020/09/13/12thDay13/#comment-container"><span class="display-none-class">8ef53469c9926a318485bca1b603caf5</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="8ef53469c9926a318485bca1b603caf5">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 分鐘  <i class="fas fa-pencil-alt"> </i>0.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/13/12thDay13/">Day13 - 嵌入式訊息embed與 bot 的指令表(額外)</a></h1><div class="content"><p>今天說說Discord的另一種訊息方式，embed</p>
<p><img src="https://i.imgur.com/6cCIVuN.png" alt="13-1"></p>
<p>在Discord.js中被稱為MessageEmbed，訊息嵌入元素，總之就是嵌入式訊息</p>
<p><img src="https://i.imgur.com/mw9N4MX.png" alt="13-2"></p>
<p>跟一般傳送訊息的手段一樣是使用 send ，但是傳送的屬性從原本的文字(string)轉成是嵌入元素(Embed)</p>
<p><img src="https://i.imgur.com/kQQYhth.png" alt="13-3"></p>
<p>embed宣告後，透過其文檔底下的各個方法(methods)來賦予嵌入式訊息本身，要放入哪些資訊</p>
<p><img src="https://i.imgur.com/rDwYLkd.png" alt="14-4"></p>
<p>將一個一個訊息嵌入embed元素後，最後從send方法傳送到discord上，就是一則embed訊息了</p>
<p><img src="https://i.imgur.com/gRPZpUI.png" alt="14-5"></p>
<p>底下附上標準版的embed，請各位嘗試在最初教學的 ! 方法中新增一則help觸發句，將底下範例套入後，試著替換成自己的指令文檔吧!</p>
<pre><code>const embed = new Discord.MessageEmbed()
      .setColor(&#39;#0099ff&#39;)
      .setTitle(&#39;Some title&#39;)
      .setURL(&#39;https://discord.js.org/&#39;)
      .setAuthor(&#39;Some name&#39;, &#39;https://i.imgur.com/wSTFkRM.png&#39;, &#39;https://discord.js.org&#39;)
      .setDescription(&#39;Some description here&#39;)
      .setThumbnail(&#39;https://i.imgur.com/wSTFkRM.png&#39;)
      .addField(&#39;Regular field title&#39;, &#39;Some value here&#39;)
      .addField(&#39;\u200B&#39;, &#39;\u200B&#39;)
      .addField(&#39;Inline field title&#39;, &#39;Some value here&#39;, true)
      .addField(&#39;Inline field title&#39;, &#39;Some value here&#39;, true)
      .addField(&#39;Inline field title&#39;, &#39;Some value here&#39;, true)
      .setImage(&#39;https://i.imgur.com/wSTFkRM.png&#39;)
      .setTimestamp()
      .setFooter(&#39;Some footer text here&#39;, &#39;https://i.imgur.com/wSTFkRM.png&#39;);
msg.channel.send(embed);
</code></pre>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-12  <a class="commentCountImg" href="/2020/09/12/12thDay12/#comment-container"><span class="display-none-class">d460fb55bd1cca4ace331b36a1cd1401</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="d460fb55bd1cca4ace331b36a1cd1401">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分鐘  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/12/12thDay12/">Day12 - Discord的訊息刪除與更新事件(額外)</a></h1><div class="content"><p>欸…原本接下來想教後台託管與資料庫的教學的<br>但因為筆者禮拜五把文稿跟圖片還有範例程式全都留在公司了…所以這兩天筆者先教一下其他東西</p>
<p>就當作是惡補前面沒講到的Discord.js功能，我們今天來說說Discord.js的其他事件監聽吧</p>
<hr>
<h1 id="刪除與更新事件"><a href="#刪除與更新事件" class="headerlink" title="刪除與更新事件"></a>刪除與更新事件</h1><p>目前我們的所有事件都是建立在<br>使用者發送訊息 -&gt; Discord廣播給機器人 -&gt; 機器人的Message事件觸發</p>
<pre><code>client.on(&#39;message&#39;, msg =&gt; &amp;#123;&amp;#125;)
</code></pre>
<p>我們的 bot 是使用登入了 bot 自身 keyValue 的 client 來監聽 message 事件的</p>
<p><img src="https://i.imgur.com/qXdmhzO.png" alt="12-1"><br><img src="https://i.imgur.com/hbkivnR.png" alt="12-2"></p>
<p>這樣，我們在Client下的Event分類中，就會找的到message的內容</p>
<p>在程序中Client代表我們機器人本身，他的Event直接表示了他能對那些事情做出反應<br>也因此，Client的Event功能非常的多</p>
<p>今天我們來說說MessageDelete跟MessageUpdate事件，也就是當有人刪除訊息跟更新訊息的時要做的事情</p>
<p><img src="https://i.imgur.com/OZ84Nlj.png" alt="12-3"><br><img src="https://i.imgur.com/FSfPNZq.png" alt="12-4"></p>
<p>Discord.js的文庫其實也蠻簡單的，不用看那些英文在說甚麼，透過事件名稱跟屬性已經足夠我們知道<br>當有人刪除留言時，Discord會將Message返還給我們<br>當有人更新留言時，Discord會將oldMessage跟newMessage</p>
<p><img src="https://i.imgur.com/ouPctCU.png" alt="12-5"></p>
<p>請試著用console.log查看Discord分別給了我們甚麼內容吧!</p>
<p>之後我們把屬性中我們需要的元素拿出來組成字串，發送到原本的頻道去</p>
<pre><code>//抓刪 刪除事件
client.on(&#39;messageDelete&#39;, function (message) &amp;#123;
    if (!message.guild) return; //只要是來自群組的訊息
    let mStr = &#39;&#39;;
    try&amp;#123;
        mStr = mStr+
            `事件 刪除\n`+
            `使用者 $&amp;#123;message.member.user.username&amp;#125;\n`+
            `群組 $&amp;#123;message.channel.name&amp;#125;\n`+
            `刪除內容 $&amp;#123;message.content&amp;#125;`;

        client.channels.get(message.channel.id).send(mStr);
    &amp;#125;catch(err)&amp;#123;
        console.log(&quot;messageDeleteError&quot;,err);
    &amp;#125;
&amp;#125;);

//抓刪 更新事件
client.on(&#39;messageUpdate&#39;, function (oldMessage, newMessage) &amp;#123;
    if (!oldMessage.guild || !newMessage.guild) return;
    mStr = &#39;&#39;;
    try &amp;#123;
        mStr = mStr +
            `事件 更新\n` +
            `使用者 $&amp;#123;oldMessage.member.user.username&amp;#125;\n` +
            `群組   $&amp;#123;oldMessage.channel.name&amp;#125;\n` +
            `舊對話 $&amp;#123;oldMessage.content&amp;#125;\n` +
            `新對話 $&amp;#123;newMessage.content&amp;#125;`;

        client.channels.get(oldMessage.channel.id).send(mStr);
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;messageUpdateError&#39;, err);
    &amp;#125;
&amp;#125;)
</code></pre>
<p>這樣，你的bot就會在頻道有人刪除訊息時接收訊息，然後把刪除的內容貼出來玩羞恥play了(</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-11  <a class="commentCountImg" href="/2020/09/11/12thDay11/#comment-container"><span class="display-none-class">f46eab08f4240d9a71ab0704f5fa3ce0</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="f46eab08f4240d9a71ab0704f5fa3ce0">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>5 分鐘  <i class="fas fa-pencil-alt"> </i>0.8 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/11/12thDay11/">Day11 - 音樂系統(2)</a></h1><div class="content"><p><img src="https://i.imgur.com/0pmzip7.png" alt="11-1"></p>
<p>今天我們把剩下的功能做完</p>
<p>繼續做之前，我們回顧一下音樂播放的其中一小段</p>
<p><img src="https://i.imgur.com/LxEyK0Q.png" alt="11-2"></p>
<p>在playMusic2這段，我們將音樂網址與相關設定打入connection後，connection開始播放歌曲，並且返還控制項；<br>我們宣告一個dispatcher來接收控制項，並且在下一行監聽finish事件</p>
<p>從這一段會注意到他解決了一件事情，那就是我們該怎麼監測歌曲播放的狀態?</p>
<p>dispatcher這個物件在被賦予後，可以直接當成是我們的遙控器<br>不管是監聽歌曲是不是播完了，還是調整音量&amp;咖歌等，都會需要調用dispatcher</p>
<p>所以如果之後我們要繼續實作咖歌&amp;循環播放等功能，除了需要調用歌曲清單以外，還需要調用到dispatcher</p>
<p><img src="https://i.imgur.com/pcZSGNK.png" alt="11-3"></p>
<p>這邊在音樂系統的最上方，將dispatcher宣告成全域變數<br>並且記得原本宣告dispatcher的const要拿掉!</p>
<p>觀念說完，那我們繼續:</p>
<h2 id="中斷歌曲"><a href="#中斷歌曲" class="headerlink" title="中斷歌曲"></a>中斷歌曲</h2><pre><code>//?skip
function skipMusic() &amp;#123;
    //將歌曲關閉，觸發finish事件
    if (dispatcher !== undefined) dispatcher.end();
&amp;#125;
</code></pre>
<h2 id="重播歌曲"><a href="#重播歌曲" class="headerlink" title="重播歌曲"></a>重播歌曲</h2><pre><code>//?replay
function replayMusic() &amp;#123;
    if (musicList.length &gt; 0) &amp;#123;
        //把當前曲目再推一個到最前面
        musicList.unshift(musicList[0]);
        //將歌曲關閉，觸發finish事件
        //finish事件將清單第一首歌排出，然後繼續播放下一首
        if (dispatcher !== undefined) dispatcher.end();
    &amp;#125;
&amp;#125;
</code></pre>
<h2 id="顯示歌曲清單"><a href="#顯示歌曲清單" class="headerlink" title="顯示歌曲清單"></a>顯示歌曲清單</h2><pre><code>//?queue
async function queueShow(channelID) &amp;#123;
    try &amp;#123;
        if (musicList.length &gt; 0) &amp;#123;
            let info;
            let message = &#39;&#39;;
            for (i = 0; i &lt; musicList.length; i++) &amp;#123;
                //從連結中獲取歌曲資訊 標題 總長度等
                info = await ytdl.getInfo(musicList[i]);
                //歌曲標題
                title = info.videoDetails.title;
                //串字串
                message = message + `\n$&amp;#123;i+1&amp;#125;. $&amp;#123;title&amp;#125;`;
            &amp;#125;
            //把最前面的\n拿掉
            message = message.substring(1, message.length);
            client.channels.fetch(channelID).then(channel =&gt; channel.send(message))
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;queueShowError&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<h2 id="顯示當前歌曲"><a href="#顯示當前歌曲" class="headerlink" title="顯示當前歌曲"></a>顯示當前歌曲</h2><pre><code>//?np
async function nowPlayMusic(channelID) &amp;#123;
    try &amp;#123;
        if (dispatcher !== undefined &amp;&amp; musicList.length &gt; 0) &amp;#123;
            //從連結中獲取歌曲資訊 標題 總長度等
            const info = await ytdl.getInfo(musicList[0]);
            //歌曲標題
            const title = info.videoDetails.title;
            //歌曲全長(s)
            const songLength = info.videoDetails.lengthSeconds;
            //當前播放時間(ms)
            const nowSongLength = Math.floor(dispatcher.streamTime / 1000);
            //串字串
            const message = `$&amp;#123;title&amp;#125;\n$&amp;#123;streamString(songLength,nowSongLength)&amp;#125;`;
            client.channels.fetch(channelID).then(channel =&gt; channel.send(message))
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;nowPlayMusicError&#39;);
    &amp;#125;
&amp;#125;

//▬▬▬▬▬▬▬▬▬?▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬
function streamString(songLength, nowSongLength) &amp;#123;
    let mainText = &#39;?&#39;;
    const secondText = &#39;▬&#39;;
    const whereMain = Math.floor((nowSongLength / songLength) * 100);
    let message = &#39;&#39;;
    for (i = 1; i &lt;= 30; i++) &amp;#123;
        if (i * 3.3 + 1 &gt;= whereMain) &amp;#123;
            message = message + mainText;
            mainText = secondText;
        &amp;#125; else &amp;#123;
            message = message + secondText;
        &amp;#125;
    &amp;#125;
    return message;
&amp;#125;
</code></pre>
<hr>
<p>這樣，我們的音樂系統的基本教學就告一段落</p>
<p><img src="https://i.imgur.com/MUI4mAt.png" alt="11-4"></p>
<p><img src="https://i.imgur.com/4i1uqpf.png" alt="11-5"></p>
<p><img src="https://i.imgur.com/HBYoQl6.png" alt="11-6"></p>
<p>其實音樂功能除了本篇教學的基本以外，還有很多花樣可以玩<br>這個寫法有個很大的問題是，有多個群組同時在使用時，機器人的歌單會掛掉</p>
<p>筆者明天想先說其他主題，音樂系統的教學先告一段落<br>因為繼續完善下去的話，程式的可讀性會降低，現在的音樂系統筆者認為是最純粹，最好理解的了<br>同學們不訪想想該怎麼完善這些問題，我們明天見~</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-10  <a class="commentCountImg" href="/2020/09/10/12thDay10/#comment-container"><span class="display-none-class">3fd637afbdfaed33868a292f1d874c04</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="3fd637afbdfaed33868a292f1d874c04">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>12 分鐘  <i class="fas fa-pencil-alt"> </i>1.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/10/12thDay10/">Day10 - 音樂系統(1)</a></h1><div class="content"><p>昨天我們把架構很籠統的說了大概<br>今天的內容會專注在編程為主，discord.js的元素不會再多贅述<br>可能會比較枯燥一點<br>萬里長路始於足下，同學們加油~</p>
<h2 id="音樂總方法"><a href="#音樂總方法" class="headerlink" title="音樂總方法"></a>音樂總方法</h2><p><img src="https://i.imgur.com/5wwXNdo.png" alt="10-1"></p>
<p>新增一個音樂系統的分類，然後在底下創建MusicFunction方法<br>一併把OnMessage事件下的音樂指令導向這個方法<br>這樣Message事件就不會因為我們的程式碼肥大，進而影響閱讀</p>
<pre><code>function MusicFunction(msg) &amp;#123;
    //將訊息內的前綴字截斷，後面的字是我們要的
    const content = msg.content.substring(prefix[1].Value.length);
    //指定我們的間隔符號
    const splitText = &#39; &#39;;
    //用間隔符號隔開訊息 contents[0] = 指令,contents[1] = 參數
    const contents = content.split(splitText);

    switch (contents[0]) &amp;#123;
        case &#39;play&#39;:
            //點歌&amp;播放歌曲功能
            playMusic(msg, contents);
            break;
        case &#39;replay&#39;:
            //重播當前歌曲
            break;
        case &#39;np&#39;:
            //當前歌曲資訊
            break;
        case &#39;queue&#39;:
            //歌曲清單
            break;
        case &#39;skip&#39;:
            //中斷歌曲
            break;
        case &#39;disconnect&#39;:
            //退出語音頻道並且清空歌曲清單
            disconnectMusic(msg.guild.id, msg.channel.id);
            break;
    &amp;#125;
&amp;#125;
</code></pre>
<p>按照昨天說的，我們分割字串後，用switch case把每個指令獨立出來<br>後面指令也會function化，用呼叫的更加美觀</p>
<h2 id="歌曲指令-play"><a href="#歌曲指令-play" class="headerlink" title="歌曲指令 play"></a>歌曲指令 play</h2><pre><code>//?play
async function playMusic(msg, contents) &amp;#123;
    //定義我們的第一個參數必需是網址
    const urlED = contents[1];
    try &amp;#123;
        //第一個參數不是連結就要篩選掉
        if (urlED.substring(0, 4) !== &#39;http&#39;) return msg.reply(&#39;The link is not working.1&#39;);

        //透過library判斷連結是否可運行
        const validate = await ytdl.validateURL(urlED);
        if (!validate) return msg.reply(&#39;The link is not working.2&#39;);

        //獲取歌曲資訊
        const info = await ytdl.getInfo(urlED);
        //判斷資訊是否正常
        if (info.videoDetails) &amp;#123;
            //指令下達者是否在語音頻道
            if (msg.member.voice.channel) &amp;#123;
                //判斷bot是否已經連到語音頻道 是:將歌曲加入歌單 不是:進入語音頻道並且播放歌曲
                if (!client.voice.connections.get(msg.guild.id)) &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    //進入語音頻道
                    msg.member.voice.channel.join()
                        .then(connection =&gt; &amp;#123;
                            msg.reply(&#39;來了~&#39;);
                            const guildID = msg.guild.id;
                            const channelID = msg.channel.id;
                            //播放歌曲
                            playMusic2(connection, guildID, channelID);
                        &amp;#125;)
                        .catch(err =&gt; &amp;#123;
                            msg.reply(&#39;bot進入語音頻道時發生錯誤，請再試一次&#39;);
                            console.log(err, &#39;playMusicError2&#39;);
                        &amp;#125;)
                &amp;#125; else &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    msg.reply(&#39;已將歌曲加入歌單!&#39;);
                &amp;#125;
            &amp;#125; else return msg.reply(&#39;請先進入頻道:3...&#39;);
        &amp;#125; else return msg.reply(&#39;The link is not working.3&#39;);
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusicError&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<p><img src="https://i.imgur.com/RGusrht.png" alt="10-2"></p>
<p>寫到這會發現需要一個填充歌曲列表的變數，歌曲列表應該是不管到哪一個音樂系統下都可以使用的，所以我們宣告在function外面(全域變數)</p>
<pre><code>//?play 遞迴函式
async function playMusic2(connection, guildID, channelID) &amp;#123;
    try &amp;#123;
        //播放前歌曲清單不能沒有網址
        if (musicList.length &gt; 0) &amp;#123;
            //設定音樂相關參數
            const streamOptions = &amp;#123;
                seek: 0,
                volume: 0.5,
                Bitrate: 192000,
                Passes: 1,
                highWaterMark: 1
            &amp;#125;;
            //讀取清單第一位網址
            const stream = await ytdl(musicList[0], &amp;#123;
                filter: &#39;audioonly&#39;,
                quality: &#39;highestaudio&#39;,
                highWaterMark: 26214400 //25ms
            &amp;#125;)

            //播放歌曲，並且存入dispatcher
            const dispatcher = connection.play(stream, streamOptions);
            //監聽歌曲播放結束事件
            dispatcher.on(&quot;finish&quot;, finish =&gt; &amp;#123;
                //將清單中第一首歌清除
                if (musicList.length &gt; 0) musicList.shift();
                //播放歌曲
                playMusic2(connection, guildID, channelID);
            &amp;#125;)
        &amp;#125; else disconnectMusic(guildID, channelID); //清空歌單並且退出語音頻道
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusic2Error&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<h2 id="歌曲指令-disconnect"><a href="#歌曲指令-disconnect" class="headerlink" title="歌曲指令 disconnect"></a>歌曲指令 disconnect</h2><pre><code>//?disconnect
function disconnectMusic(guildID, channelID) &amp;#123;
    try &amp;#123;
        //判斷bot是否在此群組的語音頻道
        if (client.voice.connections.get(guildID)) &amp;#123;
            //清空歌曲清單
            musicList = new Array();
            //退出語音頻道
            client.voice.connections.get(guildID).disconnect();

            client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;晚安~&#39;));
        &amp;#125; else client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;可是..我還沒進來:3&#39;))
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;disconnectMusicError&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<p>到此，音樂系統的一個基本循環(播放-&gt;退出)就寫完了<br>明天我們繼續完善剩下的功能</p>
<p>以下是今天的程式碼</p>
<pre><code>//#region 全域變數
const Discord = require(&#39;discord.js&#39;);
const client = new Discord.Client();
const ytdl = require(&#39;ytdl-core&#39;);
const auth = require(&#39;./JSONHome/auth.json&#39;);
const prefix = require(&#39;./JSONHome/prefix.json&#39;);

//#endregion

//#region 登入
client.login(auth.key);

client.on(&#39;ready&#39;, () =&gt; &amp;#123;
    console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
&amp;#125;);

//#endregion

//#region message事件入口
client.on(&#39;message&#39;, msg =&gt; &amp;#123;
    //前置判斷
    try &amp;#123;
        if (!msg.guild || !msg.member) return; //訊息內不存在guild元素 = 非群組消息(私聊)
        if (!msg.member.user) return; //幫bot值多拉一層，判斷上層物件是否存在
        if (msg.member.user.bot) return; //訊息內bot值為正 = 此消息為bot發送
    &amp;#125; catch (err) &amp;#123;
        return;
    &amp;#125;

    //字串分析
    try &amp;#123;
        let tempPrefix = &#39;-1&#39;;
        const prefixED = Object.keys(prefix); //前綴符號定義
        prefixED.forEach(element =&gt; &amp;#123;
            if (msg.content.substring(0, prefix[element].Value.length) === prefix[element].Value) &amp;#123;
                tempPrefix = element;
            &amp;#125;
        &amp;#125;);

        //實作
        switch (tempPrefix) &amp;#123;
            case &#39;0&#39;: //文字回應功能
                const cmd = msg.content.substring(prefix[tempPrefix].Value.length).split(&#39; &#39;); //以空白分割前綴以後的字串
                switch (cmd[0]) &amp;#123;
                    case &#39;ping&#39;:
                        msg.channel.send(&#39;pong&#39;);
                        break;
                    case &#39;老婆&#39;:
                        msg.reply(&#39;你沒有老婆!!&#39;);
                        break;
                    case &#39;myAvatar&#39;:
                        const avatar = GetMyAvatar(msg);
                        if (avatar.files) msg.channel.send(`$&amp;#123;msg.author&amp;#125;`, avatar).catch(err =&gt; &amp;#123; console.log(err) &amp;#125;);
                        break;
                &amp;#125;
                break;
            case &#39;1&#39;: //音樂指令
                MusicFunction(msg);
                break;
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;OnMessageError&#39;, err);
    &amp;#125;
&amp;#125;);

//#endregion

//#region 音樂系統

//歌曲清單
let musicList = new Array();

function MusicFunction(msg) &amp;#123;
    //將訊息內的前綴字截斷，後面的字是我們要的
    const content = msg.content.substring(prefix[1].Value.length);
    //指定我們的間隔符號
    const splitText = &#39; &#39;;
    //用間隔符號隔開訊息 contents[0] = 指令,contents[1] = 參數
    const contents = content.split(splitText);

    switch (contents[0]) &amp;#123;
        case &#39;play&#39;:
            //點歌&amp;播放歌曲功能
            playMusic(msg, contents);
            break;
        case &#39;replay&#39;:
            //重播當前歌曲
            break;
        case &#39;np&#39;:
            //當前歌曲資訊
            break;
        case &#39;queue&#39;:
            //歌曲清單
            break;
        case &#39;skip&#39;:
            //中斷歌曲
            break;
        case &#39;disconnect&#39;:
            //退出語音頻道並且清空歌曲清單
            disconnectMusic(msg.guild.id, msg.channel.id);
            break;
    &amp;#125;
&amp;#125;

//?play
async function playMusic(msg, contents) &amp;#123;
    //定義我們的第一個參數必需是網址
    const urlED = contents[1];
    try &amp;#123;
        //第一個參數不是連結就要篩選掉
        if (urlED.substring(0, 4) !== &#39;http&#39;) return msg.reply(&#39;The link is not working.1&#39;);

        //透過library判斷連結是否可運行
        const validate = await ytdl.validateURL(urlED);
        if (!validate) return msg.reply(&#39;The link is not working.2&#39;);

        //獲取歌曲資訊
        const info = await ytdl.getInfo(urlED);
        //判斷資訊是否正常
        if (info.videoDetails) &amp;#123;
            //指令下達者是否在語音頻道
            if (msg.member.voice.channel) &amp;#123;
                //判斷bot是否已經連到語音頻道 是:將歌曲加入歌單 不是:進入語音頻道並且播放歌曲
                if (!client.voice.connections.get(msg.guild.id)) &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    //進入語音頻道
                    msg.member.voice.channel.join()
                        .then(connection =&gt; &amp;#123;
                            msg.reply(&#39;來了~&#39;);
                            const guildID = msg.guild.id;
                            const channelID = msg.channel.id;
                            //播放歌曲
                            playMusic2(connection, guildID, channelID);
                        &amp;#125;)
                        .catch(err =&gt; &amp;#123;
                            msg.reply(&#39;bot進入語音頻道時發生錯誤，請再試一次&#39;);
                            console.log(err, &#39;playMusicError2&#39;);
                        &amp;#125;)
                &amp;#125; else &amp;#123;
                    //將歌曲加入歌單
                    musicList.push(urlED);
                    msg.reply(&#39;已將歌曲加入歌單!&#39;);
                &amp;#125;
            &amp;#125; else return msg.reply(&#39;請先進入頻道:3...&#39;);
        &amp;#125; else return msg.reply(&#39;The link is not working.3&#39;);
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusicError&#39;);
    &amp;#125;
&amp;#125;

//?play 遞迴函式
async function playMusic2(connection, guildID, channelID) &amp;#123;
    try &amp;#123;
        //播放前歌曲清單不能沒有網址
        if (musicList.length &gt; 0) &amp;#123;
            //設定音樂相關參數
            const streamOptions = &amp;#123;
                seek: 0,
                volume: 0.5,
                Bitrate: 192000,
                Passes: 1,
                highWaterMark: 1
            &amp;#125;;
            //讀取清單第一位網址
            const stream = await ytdl(musicList[0], &amp;#123;
                filter: &#39;audioonly&#39;,
                quality: &#39;highestaudio&#39;,
                highWaterMark: 26214400 //25ms
            &amp;#125;)

            //播放歌曲，並且存入dispatcher
            const dispatcher = connection.play(stream, streamOptions);
            //監聽歌曲播放結束事件
            dispatcher.on(&quot;finish&quot;, finish =&gt; &amp;#123;
                //將清單中第一首歌清除
                if (musicList.length &gt; 0) musicList.shift();
                //播放歌曲
                playMusic2(connection, guildID, channelID);
            &amp;#125;)
        &amp;#125; else disconnectMusic(guildID, channelID); //清空歌單並且退出語音頻道
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;playMusic2Error&#39;);
    &amp;#125;
&amp;#125;

//?disconnect
function disconnectMusic(guildID, channelID) &amp;#123;
    try &amp;#123;
        //判斷bot是否在此群組的語音頻道
        if (client.voice.connections.get(guildID)) &amp;#123;
            //清空歌曲清單
            musicList = new Array();
            //退出語音頻道
            client.voice.connections.get(guildID).disconnect();

            client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;晚安~&#39;));
        &amp;#125; else client.channels.fetch(channelID).then(channel =&gt; channel.send(&#39;可是..我還沒進來:3&#39;))
    &amp;#125; catch (err) &amp;#123;
        console.log(err, &#39;disconnectMusicError&#39;);
    &amp;#125;
&amp;#125;
//#endregion

//#region 子類方法
//獲取頭像
function GetMyAvatar(msg) &amp;#123;
    try &amp;#123;
        return &amp;#123;
            files: [&amp;#123;
                attachment: msg.author.displayAvatarURL(&#39;png&#39;, true),
                name: &#39;avatar.jpg&#39;
            &amp;#125;]
        &amp;#125;;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;GetMyAvatar,Error&#39;);
    &amp;#125;
&amp;#125;

//#endregion
</code></pre>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-09  <a class="commentCountImg" href="/2020/09/09/12thDay9/#comment-container"><span class="display-none-class">ce036539167abed1e5e0efe1e5586862</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="ce036539167abed1e5e0efe1e5586862">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>6 分鐘  <i class="fas fa-pencil-alt"> </i>0.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/09/12thDay9/">Day9 - 註解摺疊與音樂系統介紹</a></h1><div class="content"><p>昨天我們把機器人的架構做了些修改，對功能做了分類<br>今天我們稍微整理一下程式，並且說說音樂系統；<br>如果正在觀看文章的小夥伴不需要音樂系統可以跳過接下來三天的內容，不會影響後續教學的!</p>
<h1 id="region"><a href="#region" class="headerlink" title="region"></a>region</h1><p><img src="https://i.imgur.com/oZB8tKp.png" alt="9-1"></p>
<p>開始寫音樂前，因為程式碼準備要開始增加了<br>筆者先對所有程式做了分類<br>#region<br>#endregion<br>被這兩段覆蓋的程式碼可以摺疊，摺疊後只看的到region後的字</p>
<p><img src="https://i.imgur.com/w6UlfLn.png" alt="9-2"></p>
<p>這個功能必須IDE有支援才可以使用，VSCode支援這個好用的收納方法，所以我們就好好利用一下!</p>
<hr>
<h1 id="函式庫安裝"><a href="#函式庫安裝" class="headerlink" title="函式庫安裝"></a>函式庫安裝</h1><p>那麼我們準備要開始音樂功能了喔!<br>在正式開始撰寫前，我們先開啟終端機<br>依序安裝<br>npm install ffmpeg-static<br>npm install opusscript<br>跟<br>npm install ytdl-core</p>
<p><img src="https://i.imgur.com/zYAoHnj.png" alt="9-3"></p>
<p>記得路徑要在project的根目錄下</p>
<p>這些都是discordBot要播放音樂時需要的插件<br>其中ytdl-core是後續抓取youtube歌曲的library，會需要透過程式來調用<br>所以安裝完之後，我們還要在最上面引用ytdl-core</p>
<p><img src="https://i.imgur.com/zyCqZa8.png" alt="9-4"></p>
<p>這樣一來，撰寫音樂系統的前置作業都算完成了!<br>那麼接下來就該開始撰寫程式囉?nonono</p>
<p>實際上我們在撰寫程式前應該先去參考網路上是否有重複的功能可以參考</p>
<p>既然要寫音樂系統，那當然必需先參考其他人的音樂機器人是怎麼寫的囉!</p>
<hr>
<h1 id="音樂系統整理"><a href="#音樂系統整理" class="headerlink" title="音樂系統整理"></a>音樂系統整理</h1><p>Discord 教學 - 如何簡單加音樂機器人進伺服器 (Rythm)<br><a target="_blank" rel="noopener" href="https://fightwennote.blogspot.com/2018/06/discord-rythm.html">https://fightwennote.blogspot.com/2018/06/discord-rythm.html</a></p>
<p>Rythm是筆者在研究音樂系統前，看過最多次的音樂Bot<br>Rythm的功能非常完善，觀察他的指令對於描繪心目中那個接收音樂指令的Bot架構十分有幫助</p>
<p><img src="https://i.imgur.com/INTGTOT.png" alt="9-5"></p>
<p><img src="https://i.imgur.com/sIgLCsj.png" alt="9-6"></p>
<p>!play (網址)</p>
<p>提供youtube音樂的網址，bot需判斷網址是否符合規範，是不是抓得到歌<br>並且判斷使用者是不是在語音頻道，一切都正常無誤後反饋音樂資訊並且播放歌曲</p>
<p><img src="https://i.imgur.com/XNDlGTj.png" alt="9-7"></p>
<p>!replay</p>
<p>輸入此指令後，讓歌曲重頭開始播放<br>與play一樣，如果使用者不在音樂頻道中，則此指令失效</p>
<p><img src="https://i.imgur.com/rHmPN8m.png" alt="9-8"></p>
<p>!np </p>
<p>顯示當前播放歌曲資訊</p>
<p><img src="https://i.imgur.com/wqhXg2H.png" alt="9-9"></p>
<p>!queue</p>
<p>顯示歌曲清單</p>
<p><img src="https://i.imgur.com/mfzApM9.png" alt="9-10"></p>
<p>!skip</p>
<p>跳過當前播放曲目</p>
<hr>
<p>其他還有循環播放，單曲循環，請機器人退出語音廳等…</p>
<p>我們大概知道了，一個音樂系統需要<br>前綴詞(!)，表示我現在下的指令是音樂系統</p>
<p>音樂指令(play)，表示我在音樂系統中要使用哪一個功能</p>
<p>內容(xxx.com.tw)，不是一定會有，當指定功能需要參數時，我們需要給予他對應的內容</p>
<p>間隔符號(空格) 用來將音樂指令與內容分隔開的決定性符號</p>
<p><img src="https://i.imgur.com/J7cWTuc.png" alt="9-11"></p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-08  <a class="commentCountImg" href="/2020/09/08/12thDay8/#comment-container"><span class="display-none-class">6ba4c5a1bb15a3f406e4b8d629f57a66</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="6ba4c5a1bb15a3f406e4b8d629f57a66">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>6 分鐘  <i class="fas fa-pencil-alt"> </i>0.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/08/12thDay8/">Day8 - 呃...他會需要更多前綴字</a></h1><div class="content"><p>昨天我們對message事件做了完善的前置判斷</p>
<p>如果你做的跟範例一樣，這時我們可以在 ! 後面加入任何字串，來命令機器人做對應的事情</p>
<p>假設之後機器人的指令不斷增加，除了單純的文字回覆，可能還會有查表，投票，管理員指令，權限控制與音樂功能等</p>
<p>這種時候、比起單純的只使用!，機器人支援多種前綴詞顯然是更好的分類手段<br>今天我們進一步修改昨天已經完善的message框架，並且做出音樂功能(假)</p>
<hr>
<p>首先，請幫我在DiscordBot資料夾內新增一個JSONHome資料夾，把auth.json放進去，然後新增一個prefix.json檔</p>
<p><img src="https://i.imgur.com/fW5erlr.png" alt="8-1"><br><img src="https://i.imgur.com/0Io1ydQ.png" alt="8-2"></p>
<p>(prefix.json的內容)</p>
<p>bot.js的最上方幫我加載prefix.json</p>
<p><img src="https://i.imgur.com/0kIli9N.png" alt="8-3"></p>
<p>(auth.json的路徑記得也要一併修改喔!)</p>
<hr>
<p>我們把前綴字整理成了JSONArray物件<br>這樣一來，我們就做到了前綴字的統整，之後不管是新增或調用參數都會方便許多</p>
<p>然後我們把下面的message事件改成這樣</p>
<p><img src="https://i.imgur.com/m35t6Db.png" alt="8-4"></p>
<p>簡單來說就是從原本只判斷驚嘆號，變成只要前綴詞符合prefix.json內的任一Value就給過，並且由tempPrefix來接受符合條件的參數<br>同學們可以參考昨天的範例，來比對每一行的作用。</p>
<p>做到這裡，我們已經可以判斷多種前綴了，不過還沒在實作區判斷成功的是哪一個前綴<br>原本我們打!ping，機器人會回pong<br>現在打@ping也會通過了，如果prefix.json內的值不是@而是#或$$#@#$@甚麼的也一樣，依此類推<br>切割字串的方式也是可以動態化的，不過筆者不在此贅述。<br>我們繼續完善後續判斷</p>
<p><img src="https://i.imgur.com/wpLUo7R.png" alt="8-5"></p>
<p>這樣，如果使用者輸入!xxx，就會進入上方的文字回應功能<br>輸入@xxx，就會進入下方的音樂指令了</p>
<p><img src="https://i.imgur.com/xB8Rpkt.png" alt="8-6"></p>
<hr>
<p>音樂指令的部份我們明天繼續製作，以下是今天的完整程式碼:</p>
<pre><code>const Discord = require(&#39;discord.js&#39;);
const client = new Discord.Client();
const auth = require(&#39;./JSONHome/auth.json&#39;);
const prefix = require(&#39;./JSONHome/prefix.json&#39;);

client.login(auth.key);

client.on(&#39;ready&#39;, () =&gt; &amp;#123;
    console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
&amp;#125;);

client.on(&#39;message&#39;, msg =&gt; &amp;#123;
    //前置判斷
    try &amp;#123;
        if (!msg.guild || !msg.member) return; //訊息內不存在guild元素 = 非群組消息(私聊)
        if (!msg.member.user) return; //幫bot值多拉一層，判斷上層物件是否存在
        if (msg.member.user.bot) return; //訊息內bot值為正 = 此消息為bot發送
    &amp;#125; catch (err) &amp;#123;
        return;
    &amp;#125;

    //字串分析
    try &amp;#123;
        let tempPrefix = &#39;-1&#39;;
        const prefixED = Object.keys(prefix); //前綴符號定義
        prefixED.forEach(element =&gt; &amp;#123;
            if (msg.content.substring(0, prefix[element].Value.length) === prefix[element].Value) &amp;#123;
                tempPrefix = element;
            &amp;#125;
        &amp;#125;);

        //實作
        switch (tempPrefix) &amp;#123;
            case &#39;0&#39;: //文字回應功能
                const cmd = msg.content.substring(prefix[tempPrefix].Value.length).split(&#39; &#39;); //以空白分割前綴以後的字串
                switch (cmd[0]) &amp;#123;
                    case &#39;ping&#39;:
                        msg.channel.send(&#39;pong&#39;);
                        break;
                    case &#39;老婆&#39;:
                        msg.reply(&#39;你沒有老婆!!&#39;);
                        break;
                    case &#39;myAvatar&#39;:
                        const avatar = GetMyAvatar(msg);
                        if (avatar.files) msg.channel.send(`$&amp;#123;msg.author&amp;#125;`, avatar).catch(err =&gt; &amp;#123; console.log(err) &amp;#125;);
                        break;
                &amp;#125;
                break;
            case &#39;1&#39;: //音樂指令
                msg.channel.send(&#39;music&#39;);
                break;
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;OnMessageError&#39;, err);
    &amp;#125;
&amp;#125;);

//獲取頭像
function GetMyAvatar(msg) &amp;#123;
    try &amp;#123;
        return &amp;#123;
            files: [&amp;#123;
                attachment: msg.author.displayAvatarURL(&#39;png&#39;, true),
                name: &#39;avatar.jpg&#39;
            &amp;#125;]
        &amp;#125;;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;GetMyAvatar,Error&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2020-09-07  <a class="commentCountImg" href="/2020/09/07/12thDay7/#comment-container"><span class="display-none-class">43982bb76688d25b9fa5ece384a29fa0</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="43982bb76688d25b9fa5ece384a29fa0">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分鐘  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/09/07/12thDay7/">Day7 - 你的Bot需要一個前綴字</a></h1><div class="content"><p>今天接續昨天的主題，進一步修改message方法</p>
<p>正常我們在Discord上看到別人玩bot的指令都是有一個前綴字，後面附帶著指令的<br>例如: !help $dice</p>
<p>之類的，今天我們要來完成這個需求，並且把前置防呆做好</p>
<p><img src="https://i.imgur.com/biTOOUy.png" alt="7-1"></p>
<p>(終於要開始來爆改啦)</p>
<h2 id="前置判斷"><a href="#前置判斷" class="headerlink" title="前置判斷"></a>前置判斷</h2><p>除了判斷訊息是否是機器人以外，我希望機器人只回應來自群組的消息</p>
<p><img src="https://i.imgur.com/aDj39xo.png" alt="7-2"></p>
<p>因為message物件屬於discord包好給我們的，擔心有哪一層物件的錯誤導致整個機器人崩潰，我希望在前置判斷增加嚴謹性與try catch</p>
<p><img src="https://i.imgur.com/Ic1KoYn.png" alt="7-3"></p>
<p>如果這一段出錯的話，可以在catch中log錯誤訊息喔!</p>
<h2 id="字串分析"><a href="#字串分析" class="headerlink" title="字串分析"></a>字串分析</h2><p>我們希望可以在定義出前置符號後，只接取來自前置符號正確的內容，再判斷後面的內容</p>
<p><img src="https://i.imgur.com/PJZ8fnf.png" alt="7-4"></p>
<h2 id="功能實作"><a href="#功能實作" class="headerlink" title="功能實作"></a>功能實作</h2><p>最後我們把之前的行為修改一下後放回去實作區</p>
<p><img src="https://i.imgur.com/kEshR77.png" alt="7-5"></p>
<p>從原本的if改成switch，這樣我們如果要新增新的判斷式就會快速許多<br>原本判斷的msg.content改成了cmd[0]</p>
<p><img src="https://i.imgur.com/KWR5SHY.png" alt="7-6"></p>
<p>運行一下，結果就跟我們要的一樣了!</p>
<p>最後再稍微加一些範例</p>
<p><img src="https://i.imgur.com/Omv4wA5.png" alt="7-7"><br><img src="https://i.imgur.com/Q3wnJHS.png" alt="7-8"></p>
<hr>
<p>今天的完整程式碼如下</p>
<pre><code>const Discord = require(&#39;discord.js&#39;);
const client = new Discord.Client();
const auth = require(&#39;./auth.json&#39;);

client.login(auth.key);

client.on(&#39;ready&#39;, () =&gt; &amp;#123;
    console.log(`Logged in as $&amp;#123;client.user.tag&amp;#125;!`);
&amp;#125;);

client.on(&#39;message&#39;, msg =&gt; &amp;#123;
    //前置判斷
    try &amp;#123;
        if (!msg.guild || !msg.member) return; //訊息內不存在guild元素 = 非群組消息(私聊)
        if (!msg.member.user) return; //幫bot值多拉一層，判斷上層物件是否存在
        if (msg.member.user.bot) return; //訊息內bot值為正 = 此消息為bot發送
    &amp;#125; catch (err) &amp;#123;
        return;
    &amp;#125;

    //字串分析
    try &amp;#123;
        const prefix = &#39;!&#39; //前綴符號定義
        if (msg.content.substring(0, prefix.length) === prefix) //如果訊息的開頭~前綴字長度的訊息 = 前綴字
        &amp;#123;
            const cmd = msg.content.substring(prefix.length).split(&#39; &#39;); //以空白分割前綴以後的字串

            //功能實作
            switch (cmd[0]) &amp;#123;
                case &#39;ping&#39;:
                    msg.channel.send(&#39;pong&#39;);
                    break;
                case &#39;老婆&#39;:
                    msg.reply(&#39;你沒有老婆!!&#39;);
                    break;
                case &#39;myAvatar&#39;:
                    const avatar = GetMyAvatar(msg);
                    if (avatar.files) msg.channel.send(`$&amp;#123;msg.author&amp;#125;`, avatar);
                    break;
            &amp;#125;
        &amp;#125;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;OnMessageError&#39;, err);
    &amp;#125;
&amp;#125;);

//獲取頭像
function GetMyAvatar(msg) &amp;#123;
    try &amp;#123;
        return &amp;#123;
            files: [&amp;#123;
                attachment: msg.author.displayAvatarURL,
                name: &#39;avatar.jpg&#39;
            &amp;#125;]
        &amp;#125;;
    &amp;#125; catch (err) &amp;#123;
        console.log(&#39;GetMyAvatar,Error&#39;);
    &amp;#125;
&amp;#125;
</code></pre>
<p>完工~!</p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/">鐵人賽</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/">用Node.js製作後台零負擔的DiscordBot</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/node-js/">node.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/bot/">bot</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord/">discord</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/discord-js/">discord.js</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E6%95%99%E5%AD%B8/">教學</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/">12th鐵人賽</a></div><hr></div></article></div><!--!--><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/2/">上一頁</a></div><div class="pagination-next"><a href="/page/4/">下一頁</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link is-current" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://avatars.githubusercontent.com/u/62000156" alt="微笑の家"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">微笑の家</p><p class="is-size-6 is-block">請給予我拯救他人的力量</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>台灣</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">36</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分類</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">標籤</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/NALocal" target="_blank" rel="noopener">關注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/NALocal"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://www.facebook.com/profile.php?id=100003120783130"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:lion31lion31@gmail.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"來源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新評論</h3><span class="body_hot_comment">加載中，最新評論有1分鐘緩存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-14T04:00:00.000Z">2021-12-14</time></p><p class="title"><a href="/2021/12/14/racingScript-worldFlipper/">競速疊屍腳本 - 台版彈射世界</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-16T04:00:00.000Z">2021-11-16</time></p><p class="title"><a href="/2021/11/16/fluidThemeShare/">fluid支持pjax主題源碼分享</a></p><p class="categories"><a href="/categories/hexo%E4%B8%BB%E9%A1%8C%E5%88%86%E4%BA%AB/">hexo主題分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-16T02:00:00.000Z">2021-11-16</time></p><p class="title"><a href="/2021/11/16/live2DShareList/">公開Live2D模型蒐集分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-27T05:47:20.000Z">2021-09-27</time></p><p class="title"><a href="/2021/09/27/aboutDiscordJs13/">關於discord.js升級至13版本</a></p><p class="categories"><a href="/categories/BaseDiscordBot/">BaseDiscordBot</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-16T05:57:00.000Z">2021-09-16</time></p><p class="title"><a href="/2021/09/16/hello-smile/">你好，微笑之家</a></p><p class="categories"><a href="/categories/%E6%97%A5%E8%A8%98/">日記</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分類</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/BaseDiscordBot/"><span class="level-start"><span class="level-item">BaseDiscordBot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/hexo%E4%B8%BB%E9%A1%8C%E5%88%86%E4%BA%AB/"><span class="level-start"><span class="level-item">hexo主題分享</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%97%A5%E8%A8%98/"><span class="level-start"><span class="level-item">日記</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/"><span class="level-start"><span class="level-item">鐵人賽</span></span><span class="level-end"><span class="level-item tag">31</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E9%90%B5%E4%BA%BA%E8%B3%BD/%E7%94%A8Node-js%E8%A3%BD%E4%BD%9C%E5%BE%8C%E5%8F%B0%E9%9B%B6%E8%B2%A0%E6%93%94%E7%9A%84DiscordBot/"><span class="level-start"><span class="level-item">用Node.js製作後台零負擔的DiscordBot</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">歸檔</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">標籤</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/bot/"><span class="tag">bot</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/discord/"><span class="tag">discord</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/discord-js/"><span class="tag">discord.js</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/node-js/"><span class="tag">node.js</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%99%E5%AD%B8/"><span class="tag">教學</span><span class="tag is-grey-lightest">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/"><span class="tag">12th鐵人賽</span><span class="tag is-grey-lightest">31</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E8%A8%98/"><span class="tag">日記</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Live2D/"><span class="tag">Live2D</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fluid/"><span class="tag">fluid</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BD%88%E5%B0%84%E4%B8%96%E7%95%8C/"><span class="tag">彈射世界</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%85%B3%E6%9C%AC/"><span class="tag">腳本</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%81%8A%E6%88%B2/"><span class="tag">遊戲</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">訂閱更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="訂閱"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="微笑家" height="28"></a><p class="size-small"><span>&copy; 2021 NALocal</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版權說明：[本網站所有內容均收集於互聯網或自己創作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便於網友與自己學習交流，如有侵權，請<a href="/message" target="_blank">留言</a>，立即處理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已運行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小時 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！ ❤️";
        }var now = new Date();setInterval("createTime('2021/09/15 18:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感謝 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光臨！ ❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/NALocal/NALocal.github.io"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="/dist/APlayer.min.css"><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-TW");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到頂端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('9a33a548232178c23121','bbdfbe2d45288ac4b37a315cb1aa7c1a50dd9fa6','NALocal','nalocal.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什麼..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什麼...","untitled":"(無標題)","posts":"文章","pages":"頁面","categories":"分類","tags":"標籤"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('9a33a548232178c23121','bbdfbe2d45288ac4b37a315cb1aa7c1a50dd9fa6','NALocal','nalocal.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>